<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Woody's 电子游牧日志]]></title>
  <link href="http://woody1983.github.com/atom.xml" rel="self"/>
  <link href="http://woody1983.github.com/"/>
  <updated>2012-08-26T20:10:23+08:00</updated>
  <id>http://woody1983.github.com/</id>
  <author>
    <name><![CDATA[Woody.Xu]]></name>
    <email><![CDATA[unix1983@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[The Artisan's Art Spirit]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/26/the-artisans-art-spirit/"/>
    <updated>2012-08-26T15:52:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/26/the-artisans-art-spirit</id>
    <content type="html"><![CDATA[<p>偶然一个机会在罗永浩的微博看到这样一段话，感觉不错，随即抄了下来。</p>

<h3>罗永浩提到的工匠精神：</h3>

<h5>1）对所从事的事情有一种完美主义情节，在力所能及的情况下做到极致。</h5>

<h5>2）对细节的执着，点点滴滴决不放过。</h5>

<h5>3）激情，对所做的事欲罢不能，并从中获得巨大的心灵满足。</h5>

<h5>4）执着，百折不挠的勇气。可惜，这年头太缺乏具有工匠精神的人。</h5>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曾国藩 家书一篇]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/22/zengguofan/"/>
    <updated>2012-08-22T20:54:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/22/zengguofan</id>
    <content type="html"><![CDATA[<h2>课程</h2>

<pre><code>主敬  整齐严肃，无时不惧。无事时心在腔子里，应事时专一不杂。
静坐  每日不拘何时，静坐一会，体验静极生阳来复之仁心，正位凝命，如鼎之镇。
早起  黎明即起，醒后勿沾恋。
读书不二  一书未点完，断不看他书。东翻西阅，都是徇外为人。
读史  《二十三史》每日读十页，虽有事不间断。 
写日记  须端楷，凡日间过恶，身过、心过、口过，皆记出，终身不间断。
日知其所亡  每日记“茶余偶谈”一则，分德行门、学问门、经济门、艺术门。
月无忘所能  每月作诗文数首，以验积理之多寡，养气之盛否。
谨言  刻刻留心。
养气  无不可对人言之事，气藏丹田。
保身  谨遵大人手谕：节欲，节劳，节饮食。
作字  早饭后作字，凡笔墨应酬，当作自己功课。
夜不出门  旷功疲神，切戒切戒。
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[mvc]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/22/mvc/"/>
    <updated>2012-08-22T00:36:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/22/mvc</id>
    <content type="html"><![CDATA[<p><img src="http://ruby.railstutorial.org/images/figures/mvc_detailed.png" alt="About MVC" />
* The browser issues a request for the /users URI.
* Rails routes /users to the index action in the Users controller.
* The index action asks the User model to retrieve all users (User.all).
* The User model pulls all the users from the database.
* The User model returns the list of users to the controller.
* The controller captures the users in the @users variable, which is passed to the index view.
* The view uses embedded Ruby to render the page as HTML.
* The controller passes the HTML back to the browser.3</p>

<p><img src="http://ruby.railstutorial.org/images/figures/demo_controller_inheritance.png" title="Optional title attribute" alt="About Controller" />
<code>app/controllers/application_controller.rb</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails学习全记录]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/22/rails-notes/"/>
    <updated>2012-08-22T00:10:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/22/rails-notes</id>
    <content type="html"><![CDATA[<h3>创建rails项目 跳过unit-test模块</h3>

<p><code>rails new sample_app --skip-test-unit</code></p>

<h3>不安装production环境所需要的gem</h3>

<p><code>bundle install --without production</code></p>

<h3>创建rspec测试模块</h3>

<p><code>rails generate rspec:install</code></p>

<h3>创建一个负责静态页面的控制器</h3>

<p><code>rails generate controller StaticPages home help --no-test-framework</code></p>

<p>其实还可以添加 about contact等方法</p>

<p>删除一个控制器<code>rails destroy  controller FooBars baz quux</code></p>

<!-- more -->


<h3>route中的get方法</h3>

<p><code>config/routes.rb</code></p>

<p>by using get we arrange for the route to respond to a GET request
<code>get "static_pages/about"</code></p>

<h4>The first step is to generate an integration test (request spec) for our static pages:</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rails generate integration_test static_pages
</span><span class='line'>      invoke  rspec
</span><span class='line'>      create    spec/requests/static_pages_spec.rb</span></code></pre></td></tr></table></div></figure>


<h1>About RSpec</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>describe "场景/描述“ do
</span><span class='line'>  it "..." do
</span><span class='line'>    ...
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<h4>一段it语句</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>it "should have the content 'Sample App'" do #应该可以看到Sample App这个字样
</span><span class='line'>      visit '/static_pages/home' #访问这个path
</span><span class='line'>      page.should have_content('Sample App') #页面上(page) 应该会包含这个content
</span><span class='line'>    end</span></code></pre></td></tr></table></div></figure>


<h1>should and should_not 一招鲜</h1>

<p>uses the <code>Capybara</code> function <code>visit</code></p>

<p><code>spec/requests/static_pages_spec.rb</code> 可以将不同的静态页面定义到不同的describe中去测试 测试指定页面中是否包含什么文字</p>

<h3>再添加一个静态页面呢？</h3>

<ul>
<li>首先route中需要添加新的<code>get "static_pages/about"</code></li>
<li>controllers指定def</li>
<li>views中有对应的<code>html</code>页面<code>app/views/static_pages/about.html.erb</code></li>
</ul>


<h4>选择测试某一个元素 比如 title h1 等</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>page.should have_selector('title',
</span><span class='line'>                    :text =&gt; "Ruby on Rails Tutorial Sample App | Home")</span></code></pre></td></tr></table></div></figure>


<p>This uses the have_selector method, which checks for an HTML element (the “selector”) with the given content.
要查找的内容也可以用缩写 只寻找<code>关键字</code>
<code>page.should have_selector('title', :text =&gt; " | Home")</code></p>

<h3>Provide方法 可以提供临时变量给一个label</h3>

<p><code>&lt;% provide(:title, 'Home') %&gt;</code></p>

<h5>使用</h5>

<p><code>&lt;title&gt;Ruby on Rails Tutorial Sample App | &lt;%= yield(:title) %&gt;&lt;/title&gt;</code></p>

<blockquote><p>http://ruby.railstutorial.org/chapters/static-pages#top 明天继续</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[关于rspec浅见]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/20/about-rspec/"/>
    <updated>2012-08-20T20:52:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/20/about-rspec</id>
    <content type="html"><![CDATA[<h3>刚入手没几天，感觉开发过程中多了很多乐趣。</h3>

<p><code>should</code> and <code>should_not</code></p>

<h2>before and after</h2>

<p>before(:each) 每段it之前执行
before(:all) 每段describe 之前执行
after(:each)
after(:all)</p>

<h3>pending 可以先列出来打算要写的代码</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;…&quot;</span>
</span><span class='line'>  <span class="n">pending</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<!-- more-->


<h3>let 语法 有需要才会出来运算。</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span><span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:is_vip</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>should 后面</h3>

<p>be_true
be_false
be_nil</p>

<h3>检查class和def</h3>

<ul>
<li>target.should be_a_kind_of(Array)      <code>target.class.should == Array</code></li>
<li>target.should be_an_instance_of(Array) <code>target.class.should == Array</code></li>
<li>target.should respond_to(:foo)         <code>target.respond_to?(:foo).should == true</code></li>
</ul>


<h3>检查array hash</h3>

<ul>
<li>target.should have_key(:foo) <code>#target[:foo].should_not == nil</code></li>
<li>target.should include(4)     <code>#target.include?(4).should == true</code></li>
<li>target.should have(3).items  <code>#target.items.length == 3</code></li>
</ul>


<h3>任何be_开头的</h3>

<ul>
<li>target.should be_empty <code>#target.empty?.should == true</code></li>
<li>target.should be_blank <code>#target.blank?.should == true</code></li>
<li>target.should be_admin <code>#target.admin?.should == true</code></li>
</ul>


<h3>should ==   一招鲜吃遍天</h3>

<h3>expect to</h3>

<h4>希望一段代码会改变某个值货丢出例外</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;should update status to shipping&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">expect</span><span class="p">{</span><span class="n">order</span><span class="o">.</span><span class="n">ship!</span><span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">change</span><span class="p">{</span><span class="n">order</span><span class="o">.</span><span class="n">status</span><span class="p">}</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="s2">&quot;new&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;shippping&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>希望status从new变成shipping</h4>

<p>和这段差不多</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;should update status to shipping &quot;</span><span class="k">do</span>
</span><span class='line'><span class="n">order</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">&quot;new&quot;</span>
</span><span class='line'><span class="n">order</span><span class="o">.</span><span class="n">ship!</span>
</span><span class='line'><span class="n">order</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">&quot;shipping&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>subject 可以省略 receiver</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">subject</span> <span class="p">{</span><span class="no">Order</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:status</span> <span class="o">=&gt;</span> <span class="s2">&quot;New&quot;</span><span class="p">)}</span>
</span><span class='line'><span class="n">it</span> <span class="p">{</span><span class="n">should</span> <span class="n">be_valid</span><span class="p">}</span> <span class="c1">#subject.valid?should == true</span>
</span><span class='line'><span class="n">its</span><span class="p">(</span><span class="ss">:status</span><span class="p">){</span><span class="n">should</span> <span class="o">==</span> <span class="s2">&quot;New&quot;</span><span class="p">}</span> <span class="c1">#subject.status.should == &quot;New&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>it example specify 是一样的 都是别名</h3>

<h4>rspec filename.rb -fs 输出specdox文件</h4>

<h4>rspec filename.rb -fh 输出html文件</h4>

<h3>useful Rspec tools</h3>

<ul>
<li>factory_girl 造测试数据</li>
<li>shoulda 更多rails专用的matcher</li>
<li>capybara 提供浏览器模拟</li>
</ul>


<h3>rcov 测试覆盖度 看有哪些代码没有测试到</h3>

<h3>Capydara</h3>

<ul>
<li>fill_in &#8216;Login&#8217;, :with=>&#8217;username&#8217;</li>
<li>click_link &#8216;Sign up&#8217;</li>
</ul>


<h3>每个it只有一个测试目的。不被周边因素影响</h3>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[About PickerViewController]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/12/about-pickerviewconyroller/"/>
    <updated>2012-08-12T12:44:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/12/about-pickerviewconyroller</id>
    <content type="html"><![CDATA[<h4>Pickers get their data from a datasource and tell their delegates when something happens</h4>

<p><code>UIPickerViewDatasource.</code> and <code>UIPickerViewDelegate.</code></p>

<p>Controls have their own specific datasources and delegates</p>

<!-- more-->


<h4>First, declare that the controller conforms to both protocols</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">@interface</span> <span class="nc">InstaEmailViewController</span> : <span class="nc">UIViewController</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">UIPickerViewDataSource</span><span class="p">,</span> <span class="n">UIPickerViewDelegate</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">NSArray</span><span class="o">*</span> <span class="n">activities_</span><span class="p">;</span>
</span><span class='line'>  <span class="n">NSArray</span><span class="o">*</span> <span class="n">feelings_</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后在InstaEmailViewController.m文件中去定义array的具体内容</p>

<figure class='code'><figcaption><span>InstaEmailViewController.m</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>  <span class="n">activities_</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSArray</span> <span class="n">alloc</span> <span class="p">]</span> <span class="nl">initWithObjects:</span><span class="s">@&quot;sleeping&quot;</span><span class="p">,</span><span class="s">@&quot;eating&quot;</span><span class="p">,</span><span class="s">@&quot;working&quot;</span><span class="p">,</span><span class="s">@&quot;thinking&quot;</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>  <span class="n">feelings_</span> <span class="o">=</span><span class="p">[[</span><span class="n">NSArray</span> <span class="n">alloc</span> <span class="p">]</span><span class="nl">initWithObjects:</span><span class="s">@&quot;awesome&quot;</span><span class="p">,</span><span class="s">@&quot;sad&quot;</span><span class="p">,</span><span class="s">@&quot;happy&quot;</span><span class="p">,</span><span class="s">@&quot;ambivalent&quot;</span><span class="p">,</span><span class="s">@&quot;nauseous&quot;</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>              <span class="c1">// Do any additional setup after loading the view, typically from a nib.</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>记得要Release出去</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">dealloc</span><span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">emailPicker_</span> <span class="n">release</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">activities_</span> <span class="n">release</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">feelings_</span> <span class="n">release</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">super</span> <span class="n">dealloc</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>The datasource protocol has two required methods</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">-</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">numberOfComponentsInPickerView:</span><span class="p">(</span><span class="n">UIPickerView</span> <span class="o">*</span><span class="p">)</span> <span class="n">pickerView</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="c1">//要返回有多少个components(组件)</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nl">pickerView:</span><span class="p">(</span><span class="n">UIPickerView</span> <span class="o">*</span><span class="p">)</span><span class="n">pickerView</span> <span class="nl">numberOfRowsInComponent:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="n">component</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">component</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">[</span><span class="n">activities_</span> <span class="n">count</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">[</span><span class="n">feelings_</span> <span class="n">count</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这一步做完以后 将<code>Outlets</code>下的Datasource link到<code>File's Owner</code>上</p>

<h3>There’s just one method for the delegate protocol</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">pickerView:</span><span class="p">(</span><span class="n">UIPickerView</span> <span class="o">*</span><span class="p">)</span><span class="nv">pickerView</span> <span class="nf">titleForRow:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">row</span> <span class="nf">forComponent:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">component</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">component</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="p">[</span><span class="n">activities_</span> <span class="nl">objectAtIndex:</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="p">[</span><span class="n">feelings_</span> <span class="nl">objectAtIndex:</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>      <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>一样 也是link到Outlets上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[first app]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/11/first-app/"/>
    <updated>2012-08-11T23:32:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/11/first-app</id>
    <content type="html"><![CDATA[<h4>iDecideViewController.h</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">iDecideViewController</span> : <span class="nc">UIViewController</span><span class="p">{</span>
</span><span class='line'>    <span class="n">UILabel</span> <span class="o">*</span><span class="n">decisionText</span><span class="p">;</span>
</span><span class='line'>    <span class="n">UITextField</span> <span class="o">*</span><span class="n">host</span><span class="p">;</span>
</span><span class='line'>    <span class="n">UITextField</span> <span class="o">*</span><span class="n">port</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">retain</span><span class="p">,</span><span class="n">nonatomic</span><span class="p">)</span> <span class="kt">IBOutlet</span> <span class="n">UILabel</span> <span class="o">*</span><span class="n">decisionText</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed_redo:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed_green:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>UIViewController 尝试声明了label和TextFiled等组件的使用，声明完毕以后需要在.storyboard中去right－click选择触发动作。并指向到<code>-(IBAction)</code>上。</p>

<!-- more -->


<h4>iDecideViewController.m</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#import &quot;iDecideViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">iDecideViewController</span> <span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">implementation</span> <span class="n">iDecideViewController</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">decisionText</span><span class="o">=</span><span class="n">decisionText_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">{</span>
</span><span class='line'>    <span class="n">decisionText_</span><span class="p">.</span><span class="n">text</span><span class="o">=</span><span class="s">@&quot;Go for it!&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="n">decisionText_</span><span class="p">.</span><span class="n">textColor</span><span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blackColor</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// 声明文字内容和颜色</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed_redo:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">{</span>
</span><span class='line'>    <span class="n">decisionText_</span><span class="p">.</span><span class="n">text</span><span class="o">=</span><span class="s">@&quot;You wang redo?&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="n">decisionText_</span><span class="p">.</span><span class="n">textColor</span><span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">redColor</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed_green:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">{</span>
</span><span class='line'>    <span class="n">decisionText_</span><span class="p">.</span><span class="n">text</span><span class="o">=</span><span class="s">@&quot;You choose Green&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="n">decisionText_</span><span class="p">.</span><span class="n">textColor</span><span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">greenColor</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>    <span class="n">host</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;192.168.1.100&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="n">port</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;3306&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// 加载页面自动显示 没搞明白具体有什么特别的用处 仅作demo</span>
</span><span class='line'>  <span class="c1">// Do any additional setup after loading the view, typically from a nib.</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidUnload</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">super</span> <span class="n">viewDidUnload</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">// Release any retained subviews of the main view.</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">shouldAutorotateToInterfaceOrientation:</span><span class="p">(</span><span class="n">UIInterfaceOrientation</span><span class="p">)</span><span class="nv">interfaceOrientation</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span><span class="n">interfaceOrientation</span> <span class="o">!=</span> <span class="n">UIInterfaceOrientationPortraitUpsideDown</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Here’s what YOU can do to bend your brain into submission]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/11/heres-what-you-can-do-to-bend-your-brain-into-submission/"/>
    <updated>2012-08-11T23:20:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/11/heres-what-you-can-do-to-bend-your-brain-into-submission</id>
    <content type="html"><![CDATA[<p>So, we did our part. The rest is up to you. These tips are a starting point; listen to your brain and figure out what works for you and what doesn’t. Try new things.</p>

<p><code>Cut this out and stick it on your refrigerator.</code></p>

<!-- more -->


<h3>Slow down. The more you understand, the less you have to memorize.</h3>

<p>Don’t just read. Stop and think. When the book asks you a question, don’t just skip to the answer. Imagine that someone really is asking the question. The more deeply you force your brain to think, the better chance you have of learning and remembering.</p>

<h3>Do the exercises. Write your own notes.</h3>

<p>We put them in, but if we did them for you, that would be like having someone else do your workouts for you. And don’t just look at the exercises. Use a pencil. There’s plenty of evidence that physical activity while learning can increase the learning.</p>

<h3>Read the “There Are No Dumb Questions” sections.</h3>

<p>That means all of them. They’re not optional sidebars—they’re part of the core content!
Don’t skip them.</p>

<h3>Make this the last thing you read before bed. Or at least the last challenging thing.</h3>

<p>Part of the learning (especially the transfer to long-term memory) happens after you put the book down. Your brain needs time on its own, to do more processing. If you put in something new during that processing time, some of what you just learned will be lost.</p>

<h3>Drink water. Lots of it.</h3>

<p>Your brain works best in a nice bath of fluid. Dehydration (which can happen before you ever feel thirsty) decreases cognitive function.</p>

<h3>Talk about it. Out loud.</h3>

<p>Speaking activates a different part of the brain. If you’re trying to understand something, or increase your chance of remembering it later, say it out loud. Better still, try to explain it out loud to someone else. You’ll learn more quickly, and you might uncover ideas you didn’t know were there when you were reading about it.</p>

<h3>Listen to your brain.</h3>

<p>Pay attention to whether your brain is getting overloaded. If you find yourself starting to skim the surface or forget what you just read, it’s time for a break. Once you go past a certain point, you won’t learn faster by trying to shove more in, and you might even hurt the process.</p>

<h3>Feel something!</h3>

<p>Your brain needs to know that this matters. Get involved with the stories. Make up your own captions for the photos. Groaning over a bad joke is still better than feeling nothing at all.</p>

<h3>Create something!</h3>

<p>Apply this to your daily work; use what you’re learning to make decisions on your projects. Just do something to get some experience beyond the exercises and activities in this book. All you need is a pencil and a problem to solve&#8230;a problem that might benefit from using the tools and techniques you’re studying for the exam.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iDecide's logic]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/11/idecides-logic/"/>
    <updated>2012-08-11T23:11:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/11/idecides-logic</id>
    <content type="html"><![CDATA[<h4>iDecide’s logic</h4>

<p>Any controls you create need a method that Interface Builder can use to connect the control to behaviors specified in the implementation file.</p>

<p>The .xib file describes the button as you configured it in Interface Builder.
You’ll likely notice all the files’ names have “ViewController”
in them. Don’t sweat that for now, we’ll explain that in a bit.</p>

<p>iDecideViewController.h
This line declares a method called buttonPressed that Interface Builder will recognize as a possible callback.</p>

<p>iDecideViewController.m
You provide the method implementation in the
.m file. Here’s where you code up what should actually happen when the button is pressed.</p>

<h4>IBOutlet与IBAction</h4>

<p>通过在变量前增加IBOutlet来说明该变量将与界面上的某个UI对象对应，在方法前增加IBAction来说明该方法将与界面上的事件对应.</p>

<!-- more -->


<p>Below is the code for when the button gets tapped. Add the bolded code to the iDecideViewController.h and iDecideViewController.m files. We are creating three things: the UILabel property, the IBAction to respond to the button press, and the IBOutlet to change the label when the button is pressed.</p>

<h3>iDecideViewController.h</h3>

<p><code>UILabel *decisionText_;</code></p>

<p>We need to change the label text to provide our answer, so we need an IBOutlet to be able to get to the label control that the framework will build from our nib.</p>

<p><code>@property (retain, nonatomic) IBOutlet UILabel *decisionText;</code></p>

<p>We’ll talk more about properties later in the book.</p>

<p><code>-(IBAction)buttonPressed:(id)sender;</code></p>

<p>Here’s the action that will be called when the button is pressed.</p>

<h3>iDecideViewController.m</h3>

<p><code>@synthesize decisionText=decisionText_;</code></p>

<p>The @synthesize tells the compiler to create a getter and setter for the property we declared in the header file. We’ll get into that more in Chapter 3.</p>

<p><code>-(IBAction)buttonPressed:(id)sender</code></p>

<p>This is the implementation of the method that gets called when the button is pressed.</p>

<p><code>decisionText_.text = @”Go for it!”;</code></p>

<p>We’ll use our reference to the label to change the text.</p>

<p>Click on the circle next to New Referencing Outlet and drag it to the @property statement for the Outlet in the .h file on the right. Now when the decisionText UILabel is generated, our decisionText property will reference the control, through the IBOutlet.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">//</span>
</span><span class='line'><span class="cp">//  iDecideViewController.h</span>
</span><span class='line'><span class="cp">//  iDecide</span>
</span><span class='line'><span class="cp">//</span>
</span><span class='line'><span class="cp">//  Created by Woody.Xu on 12-8-11.</span>
</span><span class='line'><span class="cp">//  Copyright (c) 2012年 Woody.Xu. All rights reserved.</span>
</span><span class='line'><span class="cp">//</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">iDecideViewController</span> : <span class="nc">UIViewController</span><span class="p">{</span>
</span><span class='line'>      <span class="n">UILabel</span> <span class="o">*</span><span class="n">decisionText</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">retain</span><span class="p">,</span><span class="n">nonatomic</span><span class="p">)</span> <span class="kt">IBOutlet</span> <span class="n">UILabel</span> <span class="o">*</span><span class="n">decisionText</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed_redo:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed_green:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>and</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#import &quot;iDecideViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">iDecideViewController</span> <span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">implementation</span> <span class="n">iDecideViewController</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">decisionText</span><span class="o">=</span><span class="n">decisionText_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">{</span>
</span><span class='line'>  <span class="n">decisionText_</span><span class="p">.</span><span class="n">text</span><span class="o">=</span><span class="s">@&quot;Go for it!&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">decisionText_</span><span class="p">.</span><span class="n">textColor</span><span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blackColor</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed_redo:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">{</span>
</span><span class='line'>  <span class="n">decisionText_</span><span class="p">.</span><span class="n">text</span><span class="o">=</span><span class="s">@&quot;You wang redo?&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">decisionText_</span><span class="p">.</span><span class="n">textColor</span><span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">redColor</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">buttonPressed_green:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">{</span>
</span><span class='line'>  <span class="n">decisionText_</span><span class="p">.</span><span class="n">text</span><span class="o">=</span><span class="s">@&quot;You choose Green&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">decisionText_</span><span class="p">.</span><span class="n">textColor</span><span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">greenColor</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[App Magnets]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/11/app-magnets/"/>
    <updated>2012-08-11T23:09:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/11/app-magnets</id>
    <content type="html"><![CDATA[<h2>App Magnets</h2>

<ul>
<li>Determine app layout. <code>确定应用程序的布局</code></li>
<li>Build the GUI <code>构建用户图形界面</code></li>
<li>Figure out how to use the controls <code>弄清楚如何使用控件</code></li>
<li>Handle the data <code>处理数据</code></li>
<li>Generate the email.  <code>生成电子邮件</code></li>
</ul>


<h3>Determine app layout.</h3>

<p>Before you start coding anything, sketch up what you’re thinking.</p>

<h3>Build the GUI</h3>

<p>Some people write backend code first—we’re going to go back and forth depending on our project, but to get started, we’ll do the GUI first this time.</p>

<h3>Figure out how to use the controls</h3>

<p>After you’ve landed on the general app design, you need to get into the documentation a little and figure out how to implement the controls you’ve chosen.</p>

<h3>Handle the data</h3>

<p>Here we need to manage the data coming from the controls.</p>

<h3>Generate the email.</h3>

<p>We’ll help you out with this last step.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[打造牛轰的todo]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/09/make-todo/"/>
    <updated>2012-08-09T20:52:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/09/make-todo</id>
    <content type="html"><![CDATA[<h3>为什么要这个todo？</h3>

<p>很重要的一个原因:<code>我们欠管</code>，而恰恰也是因为这个大多数人的todo基本上就素一个摆设，要么敷衍自己要么敷衍家长大部分是敷衍寒暑假，给自己的玩耍创造更多的舆论支持。</p>

<h3>为什么大多数的todo是没用的?</h3>

<p>很简单，我们大脑最聪明的时候就是你不告诉他该怎么做的时候，说白了就是<code>潜意识</code>，另外最要命的是我们的大脑逃避痛苦的速度是你想象不到的快，这就是人为什么容易走神而自己却不知道。</p>

<!-- more -->


<h3>举个栗子</h3>

<p>还是举个例子比较好理解，就拿学习英语这事儿来说吧，我相信大多数人上学的时候甚至是工作的时候都做过无数次的学习计划，很荣幸，我也是。</p>

<p>但计划就是计划，新概念永远是第一本看的最多遍，这就是每次时间到了大脑开始进行todo里面各项任务时经常遇到的问题。</p>

<h3>怎么做todo？最不反人类</h3>

<p>还是以英语为栗子!! 学习英语首先要确定一些东西：</p>

<ul>
<li>什么时间学？几点开始，几点结束？</li>
<li>在哪里学？</li>
<li>学习的材料在哪？</li>
<li>一次学多少？第一阶段要学到哪里？</li>
<li>怎么才算是学？你要做什么？</li>
</ul>


<p>其实第五个问题最重要，前面几个只是做铺垫。你必须知道做什么才叫做学习？否则到时间了，你还是要面对这个问题，思考的时间一拉长问题就麻烦了。</p>

<h4>我是怎么修改这个学习todo的</h4>

<ul>
<li>早上学习45min，心情好的话学一个小时。晚上有时间就看，不在计划内。</li>
<li>桌子上。坚决不在公司学，就算有时间最多写个英语的twitter练习一下</li>
<li><code>新概念</code>/<code>NCE-1</code> 别笑 我1还是没过关呢，问题是不知道怎样才算是过关</li>
<li>学多少是个问题，遥遥无期本身就是个压力，以一本教材为<code>Milestone</code>最合适。</li>
<li><code>重点</code>早上的练习任务就是超课文，抄完就默写，不用动脑子，只管做就可以了。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>再说说执行过程中的事情
</span><span class='line'>所谓抄写最好的地方就是大脑几乎不需要为这个todo的动作和流程付出太多的思考，下意识里去接受就可以了。
</span><span class='line'>题外话 如果能延伸一些的话 抄写的时候可以找一些英语对白听听，现在华尔街英语貌似有下载的mp3流出。可以拿来试试</span></code></pre></td></tr></table></div></figure>


<p>现在试验过几次，感觉是非常好的，早上起来洗漱完毕，做到桌子上下意识直接拿书起来抄，我很喜欢用笔书写时的感觉，尤其时笔尖和纸张接触使的摩擦力。但现在更多的时间使用电脑来敲打，一是比较环保，二是平时用键盘也最多，也熟悉，如果现在用键盘输入的英语练习多了的话，对以后的使用还是有帮助，总不会那么生涩吧。</p>

<p>洗洗睡了</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[C里面的Byte Bit概念和数据类型]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/08/c-byte-bit-date-type/"/>
    <updated>2012-08-08T21:16:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/08/c-byte-bit-date-type</id>
    <content type="html"><![CDATA[<h1>二进制 八进制 十六进制</h1>

<p><code>位bit</code>是含有0或1的一个单位</p>

<p>给一串二进制加上架构的概念，这样的结构叫<code>字节</code></p>

<p>一个字节<code>byte</code>由<code>8</code>位构成, 一个字<code>word</code>由<code>32</code>构成或<code>4</code>个字节</p>

<p>一个字节最大是8位，8位数的二进制 <code>1111 1111</code>换成十进制<code>255</code>,也就是说一个字节最大能存的整数是<code>255</code></p>

<p>2个字节可以存放 <code>2的16次方</code>=65535 4个字节<code>2的32次方</code>=4 294 967 295</p>

<p>大小写的26个英文字母还有10个数字和标点符号加在一起的内容在字节对应中有个<code>ASC2</code>的编码。</p>

<!-- more -->


<h3>内存编号</h3>

<blockquote><p>起始编号是1 隔8个位置加1</p></blockquote>

<table>
<thead>
<tr>
<th>起始编码1 </th>
<th> 位7 </th>
<th> 位6 </th>
<th> 位5 </th>
<th> 位4 </th>
<th> 位3 </th>
<th> 位2 </th>
<th> 位1 </th>
<th> 位0</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 </td>
<td> 0  </td>
<td> 0 </td>
<td> 0 </td>
<td> 1 </td>
<td> 0 </td>
<td> 1 </td>
<td> 1 </td>
<td> 0</td>
</tr>
<tr>
<td>2 </td>
<td> 1  </td>
<td> 0 </td>
<td> 1 </td>
<td> 1 </td>
<td> 0 </td>
<td> 0 </td>
<td> 1 </td>
<td> 1</td>
</tr>
</tbody>
</table>


<h3>C语言用的是起始地址＋长度 编码2开始 往后4个字节</h3>

<hr />

<h1>数据类型 DataType</h1>

<h4>数据类型是程序所处理的数据的抽象，将可能出现的数据进行分类 比如整数和带小数点的数。</h4>

<h4>C语言创造了很多丰富的数据类型</h4>

<ul>
<li>构造类型</li>
<li>指针类型</li>
<li>空类型</li>
<li>基本类型</li>
</ul>


<h4>基本类型</h4>

<p>枚举类型<code>enum</code> 字符类型<code>char</code> 数值类型包括<code>实型</code>和<code>整型</code></p>

<ul>
<li>实型包括 单精度<code>float</code> 双精度<code>double</code></li>
<li>整型包括 短整型<code>short</code> 整型<code>int</code> 长整型<code>long</code></li>
</ul>


<h4>构造类型</h4>

<p>包括 <code>数组</code> <code>结构体</code> <code>共用体</code></p>

<p>构造类型是由多个其他数据雷西瓜组合而成，可以分解成若干个元素或成员，每个元素或成员要么是一个基本数据类型，要么又是一个构造类型。</p>

<ul>
<li>数组 所有元素是同一个类型</li>
<li>结构体 不同数据类型的组合</li>
<li>共用体 多个雨啊宿不同数据类型 共用一块内存</li>
</ul>


<h4>空类型</h4>

<p>Void 多数用在函数和指针的地方</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>需要Google一下的内容是
</span><span class='line'>内存地址的布局方式 
</span><span class='line'>int x = 4294967295 打印出来的正好是255
</span><span class='line'>如果x的声明是4294967296 换成32地址的话
</span><span class='line'>1 0000-0000 0000-0000 0000-0000 0000-0000 
</span><span class='line'>如果x的声明是4294967297 换成32地址的话
</span><span class='line'>1 0000-0000 0000-0000 0000-0000 0000-0001 </span></code></pre></td></tr></table></div></figure>


<h1>整数类型</h1>

<blockquote><p>类型分为 short int long</p></blockquote>

<p>short <code>16-bit</code>or<code>2-byte</code> max&#8211;><code>11111111 11111111</code>二进制 <code>65535</code>十进制</p>

<p>int <code>32 bit</code> or <code>4 byte</code>max&#8211;><code>11111111 11111111 11111111 11111111</code>二进制 <code>4294967295</code>十进制</p>

<p>long <code>32 bit</code> or <code>4 byte</code>max&#8211;><code>11111111 11111111 11111111 11111111</code>二进制 <code>4294967295</code>十进制</p>

<h4>一个int类型的整数实际上就是一个32个坑 一个萝卜一个坑</h4>

<h2>整数的正负</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>有符号和无符号两种 32个坑的左边第一个坑就是用来标记正负的 最高位就是最左边那一位 0为正 1为负</span></code></pre></td></tr></table></div></figure>


<h4>关于补码 (需要另外单独资料)</h4>

<p>23的二进制是0001 0111</p>

<p>正数的补码就是该数的二进制数</p>

<p>负数的补码是 例:-23</p>

<ul>
<li>先取该数的绝对值(-23)=23</li>
<li>变成二进制 0001 0111</li>
<li>二进制取反 1变0 0变1  1110 1000</li>
<li>将取反后的值加1</li>
</ul>


<p><code>计算机中的数值是以补码的形式存储的!!!</code>
<code>所有负数的二进制补码的最高位必然也必须是1</code></p>

<p>signed int 表示4个字节的存储单元 第32位是符号位 剩下的31位才是数据位。</p>

<p>一个二进制数如何解释 还要看要把这个数当作什么数据类型来解释 unsigned int 和 signed int 最高位的字符完全代表了不同的含义 要么计算成一个数 要么当成一个正负号标记位。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[mac安装gcc和ruby]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/08/mac-install-gcc-ruby/"/>
    <updated>2012-08-08T20:27:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/08/mac-install-gcc-ruby</id>
    <content type="html"><![CDATA[<h4>gcc</h4>

<p>先说gcc 我这个mac安装过Xcode4.4 但安装过程中还是提示少c编译环境 查了一下需要安装xcode的插件</p>

<p>安装command line tools。具体路径为：<code>Xcode –&gt; Preferences –&gt; Downloads 的Components</code>下，选择安装Command Line Tools 即可。</p>

<h4>wget</h4>

<p>我下载的是source code编译安装的</p>

<!-- more -->


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget http://ftp.gnu.org/gnu/wget/wget-1.14.tar.gz
</span><span class='line'>tar zxvf wget-1.14.tar.gz
</span><span class='line'>cd wget-1.14
</span><span class='line'>./configure --with-ssl=openssl
</span><span class='line'>make
</span><span class='line'>make install</span></code></pre></td></tr></table></div></figure>


<h4>Yaml</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget http://pyyaml.org/download/libyaml/yaml-0.1.4.tar.gz`
</span><span class='line'>解tar 编译安装 不装这个东西 rvm安装ruby总是报错</span></code></pre></td></tr></table></div></figure>


<h4>rvm</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bash -s stable &lt; &lt;(curl -s https://raw.github.com/wayneeseguin/rvm/master/binscripts/rvm-installer)
</span><span class='line'>rvm --version
</span><span class='line'>
</span><span class='line'>xjmatoMacBook-Air:ruby-1.9.3-rc1 xj$ rvm install 1.9.3
</span><span class='line'>Fetching yaml-0.1.4.tar.gz to /Users/xj/.rvm/archives
</span><span class='line'>Extracting yaml-0.1.4.tar.gz to /Users/xj/.rvm/src
</span><span class='line'>Configuring yaml in /Users/xj/.rvm/src/yaml-0.1.4.
</span><span class='line'>Compiling yaml in /Users/xj/.rvm/src/yaml-0.1.4.
</span><span class='line'>Installing yaml to /Users/xj/.rvm/usr
</span><span class='line'>Building 'ruby-1.9.3-p194' using clang - but it's not (fully) supported, expect errors.
</span><span class='line'>Installing Ruby from source to: /Users/xj/.rvm/rubies/ruby-1.9.3-p194, this may take a while depending on your cpu(s)...
</span><span class='line'>中间需要download文件 
</span><span class='line'>Install of ruby-1.9.3-p194 - #complete
</span><span class='line'>Ruby 'ruby-1.9.3-p194' was built using clang - but it's not (fully) supported, expect errors.
</span><span class='line'>xjmatoMacBook-Air:ruby-1.9.3-rc1 xj$ ruby -v
</span><span class='line'>ruby 1.9.3p194 (2012-04-20 revision 35410) [x86_64-darwin11.4.0]
</span><span class='line'>xjmatoMacBook-Air:ruby-1.9.3-rc1 xj$ gem -v
</span><span class='line'>1.8.24
</span><span class='line'>安装完以后看一下</span></code></pre></td></tr></table></div></figure>


<h4>bundle</h4>

<p><code>bundle install</code></p>

<p>这个是最关键的一步 进入项目文件里面 bundle所有需要的gem包</p>

<h4>rake for octopress</h4>

<p>日常维护octopress常用的命令大概就这么几个 分别为git和rake的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake generate 声称静态页面
</span><span class='line'>rake preview 预览
</span><span class='line'>rake deploy 发布</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[关于Git的push & pull]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/07/about-git-push-and-pull/"/>
    <updated>2012-08-07T19:39:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/07/about-git-push-and-pull</id>
    <content type="html"><![CDATA[<h3>首先是两端同时维护的问题</h3>

<p>同一个git的<code>Repo</code> 我如果需要在<code>office</code>和<code>home</code>里分开维护的话 数据的一致性是最主要的。
比如我在家里写的blog，早上到公司以后就需要先pull下来最新版本的Repo 然后在一天中任何一个时间点或时间段都会随意的维护工作记录或笔记什么的。</p>

<!-- more -->


<p>现在的做法是把没写完的blog先<code>push</code>到一个<code>TODO的branch</code>里 然后push到远端一个分支 也叫todo</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>woodyxu@woodyxu-ThinkPad-R61-neo:~/woody1983.github.com$ git checkout -b todo
</span><span class='line'>Switched to a new branch 'todo'
</span><span class='line'>woodyxu@woodyxu-ThinkPad-R61-neo:~/woody1983.github.com$ git branch
</span><span class='line'>  master
</span><span class='line'>  source
</span><span class='line'>* todo
</span><span class='line'>创建一个todo的分支 
</span><span class='line'>
</span><span class='line'>woodyxu@woodyxu-ThinkPad-R61-neo:~/woody1983.github.com$ git add .
</span><span class='line'>woodyxu@woodyxu-ThinkPad-R61-neo:~/woody1983.github.com$ git commit -m "todo branch : save temp file"
</span><span class='line'>[todo 92e67d5] todo branch : save temp file
</span><span class='line'> 1 file changed, 14 insertions(+)
</span><span class='line'> create mode 100644 source/_posts/2012-08-07-about-git-push-and-pull.markdown
</span><span class='line'>woodyxu@woodyxu-ThinkPad-R61-neo:~/woody1983.github.com$ git push origin todo
</span><span class='line'>Counting objects: 8, done.
</span><span class='line'>Delta compression using up to 2 threads.
</span><span class='line'>Compressing objects: 100% (5/5), done.
</span><span class='line'>Writing objects: 100% (5/5), 883 bytes, done.
</span><span class='line'>Total 5 (delta 2), reused 0 (delta 0)
</span><span class='line'>To git@github.com:woody1983/woody1983.github.com.git
</span><span class='line'> * [new branch]      todo -&gt; todo</span></code></pre></td></tr></table></div></figure>


<blockquote><p>先merge一下 看能不能合并和发布出去。</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>woodyxu@woodyxu-ThinkPad-R61-neo:~/woody1983.github.com$ git merge todo
</span><span class='line'>Updating 60ba0bf..5a7acfa
</span><span class='line'>Fast-forward
</span><span class='line'> .../2012-08-07-about-git-push-and-pull.markdown    |   42 ++++++++++++++++++++
</span><span class='line'> 1 file changed, 42 insertions(+)
</span><span class='line'> create mode 100644 source/_posts/2012-08-07-about-git-push-and-pull.markdown
</span><span class='line'>woodyxu@woodyxu-ThinkPad-R61-neo:~/woody1983.github.com$ git add .
</span><span class='line'>woodyxu@woodyxu-ThinkPad-R61-neo:~/woody1983.github.com$ git commit -m "merge todo blog 2"
</span><span class='line'># On branch source
</span><span class='line'># Your branch is ahead of 'origin/master' by 616 commits.
</span><span class='line'>#
</span><span class='line'>nothing to commit (working directory clean) #merge过来就不需要commit了？
</span><span class='line'>woodyxu@woodyxu-ThinkPad-R61-neo:~/woody1983.github.com$ git branch
</span><span class='line'>  master
</span><span class='line'>  octopress_github/todo
</span><span class='line'>* source
</span><span class='line'>  todo
</span><span class='line'>woodyxu@woodyxu-ThinkPad-R61-neo:~/woody1983.github.com$ git push origin source
</span><span class='line'>Total 0 (delta 0), reused 0 (delta 0)
</span><span class='line'>To git@github.com:woody1983/woody1983.github.com.git
</span><span class='line'>   60ba0bf..5a7acfa  source -&gt; source
</span></code></pre></td></tr></table></div></figure>


<h4>现在source是最新的版本内容了</h4>

<h3>有一个地方需要注意的就是如何保证todo和source的一致性</h3>

<p>也就是说最安全的做法就是以后写作只在todo里面完成 先push到远端的todo分支里然后到source里去merge 最后完成发布和push</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rush OctoPress]]></title>
    <link href="http://woody1983.github.com/blog/2012/08/05/rush-octopress/"/>
    <updated>2012-08-05T19:37:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/08/05/rush-octopress</id>
    <content type="html"><![CDATA[<p><code>Git</code>+<code>Octopress</code>+<code>Ruby</code></p>

<blockquote><p>终于装好了 有些细节还需要继续调整 右边没有分类边框太特么反人类了.下次继续完善安装过程和步骤。</p></blockquote>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl -L https://get.rvm.io | bash -s stable --ruby
</span><span class='line'>
</span><span class='line'>#给 ~/.bashrc (Linux) 或 ~/.bash_profile (Mac 环境) 加上脚本引用，执行下面这行（注意修改文件名）:
</span><span class='line'>
</span><span class='line'>$ echo '[[ -s "$HOME/.rvm/scripts/rvm" ]] && . "$HOME/.rvm/scripts/rvm" # This loads RVM into a shell session.' &gt;&gt; ~/.bashrc
</span><span class='line'>
</span><span class='line'># 如果是 Linux 
</span><span class='line'>$ source ~/.bashrc
</span><span class='line'>
</span><span class='line'>#first install openssl
</span><span class='line'>rvm pkg install openssl
</span><span class='line'>
</span><span class='line'>rvm install 1.9.3 -C --with-openssl-dir=$HOME/.rvm/usr
</span><span class='line'>rvm use 1.9.3
</span><span class='line'>rvm rubygems latest
</span><span class='line'>rvm install rbenv</span></code></pre></td></tr></table></div></figure>


<h3>Depoly三部曲</h3>

<blockquote><p>建立一个source的分支用来保存博客源文件</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake generate #生成静态文件
</span><span class='line'>rake preview #本地预览
</span><span class='line'>rake deploy #发布到github 只是第一次上传会比较慢一些 后面就快很多
</span><span class='line'>
</span><span class='line'>git remote add octopress_github git@github.com:username/username.github.com.git
</span><span class='line'>git add .
</span><span class='line'>git commit -m "blog source md or something"
</span><span class='line'>git push octopress_github source</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Address.c Source Code|测试一下贴代码功能 爽</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
</span><span class='line'>    <span class="n">x</span><span class="o">=</span><span class="mh">0x76543210</span><span class="p">;</span>
</span><span class='line'>    <span class="n">y</span><span class="o">=</span><span class="mh">0xfedcba98</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">%x&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">y</span><span class="p">);</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">%d %d&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cm">/*演示变量地址和变量的值*/</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MYSQL ERROR 1372 (HY000)]]></title>
    <link href="http://woody1983.github.com/blog/2012/02/13/mysql-error-1372-hy000/"/>
    <updated>2012-02-13T18:52:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/02/13/mysql-error-1372-hy000</id>
    <content type="html"><![CDATA[<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; GRANT ALL PRIVILEGES ON KETTLE_DEMO.* TO 'dba'@'%' IDENTIFIED BY PASSWORD 'dba';
</span><span class='line'>ERROR 1372 (HY000): Password hash should be a 41-digit hexadecimal number</span></code></pre></td></tr></table></div></figure>


<h3>将密码函数化</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; select password('dba');
</span><span class='line'>+-------------------------------------------+
</span><span class='line'>| password('dba')                           |
</span><span class='line'>+-------------------------------------------+
</span><span class='line'>| *381AD08BBFA647B14C82AC1094A29AD4D7E4F51D |
</span><span class='line'>+-------------------------------------------+
</span><span class='line'>1 row in set (0.00 sec)
</span><span class='line'>mysql&gt; GRANT ALL PRIVILEGES ON KETTLE_DEMO.* TO 'dba'@'%' IDENTIFIED BY PASSWORD '*381AD08BBFA647B14C82AC1094A29AD4D7E4F51D';
</span><span class='line'>Query OK, 0 rows affected (0.00 sec)</span></code></pre></td></tr></table></div></figure>


<p>OK了!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[【转】MySQL存储过程例子，包含事务，参数，嵌套调用，游标，循环等]]></title>
    <link href="http://woody1983.github.com/blog/2012/01/03/mysql-sp/"/>
    <updated>2012-01-03T19:02:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2012/01/03/mysql-sp</id>
    <content type="html"><![CDATA[<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">drop</span> <span class="k">procedure</span> <span class="n">if</span> <span class="k">exists</span> <span class="n">pro_rep_shadow_rs</span><span class="p">;</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">|</span>
</span><span class='line'><span class="c1">----------------------------------   </span>
</span><span class='line'><span class="c1">-- rep_shadow_rs   </span>
</span><span class='line'><span class="c1">-- 用来处理信息的增加，更新和删除   </span>
</span><span class='line'><span class="c1">-- 每次只更新上次以来没有做过的数据   </span>
</span><span class='line'><span class="c1">-- 根据不同的标志位   </span>
</span><span class='line'><span class="c1">-- 需要一个输出的参数，   </span>
</span><span class='line'><span class="c1">-- 如果返回为0，则调用失败，事务回滚   </span>
</span><span class='line'><span class="c1">-- 如果返回为1，调用成功，事务提交   </span>
</span><span class='line'><span class="c1">--   </span>
</span><span class='line'><span class="c1">-- 测试方法   </span>
</span><span class='line'><span class="c1">-- call pro_rep_shadow_rs(@rtn);   </span>
</span><span class='line'><span class="c1">-- select @rtn;   </span>
</span><span class='line'><span class="c1">----------------------------------   </span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">pro_rep_shadow_rs</span><span class="p">(</span><span class="k">out</span> <span class="n">rtn</span> <span class="nb">int</span><span class="p">)</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'>    <span class="c1">-- 声明变量，所有的声明必须在非声明的语句前面   </span>
</span><span class='line'>    <span class="k">declare</span> <span class="n">iLast_rep_sync_id</span> <span class="nb">int</span> <span class="k">default</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="k">declare</span> <span class="n">iMax_rep_sync_id</span> <span class="nb">int</span> <span class="k">default</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">-- 如果出现异常，或自动处理并rollback,但不再通知调用方了   </span>
</span><span class='line'>    <span class="c1">-- 如果希望应用获得异常，需要将下面这一句，以及启动事务和提交事务的语句全部去掉   </span>
</span><span class='line'>    <span class="k">declare</span> <span class="n">exit</span> <span class="k">handler</span> <span class="k">for</span> <span class="k">sqlexception</span> <span class="k">rollback</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">-- 查找上一次的   </span>
</span><span class='line'>    <span class="k">select</span> <span class="n">eid</span> <span class="k">into</span> <span class="n">iLast_rep_sync_id</span> <span class="k">from</span> <span class="n">rep_de_proc_log</span> <span class="k">where</span> <span class="n">tbl</span><span class="o">=</span><span class="s1">&#39;rep_shadow_rs&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">-- 如果不存在，则增加一行   </span>
</span><span class='line'>    <span class="n">if</span> <span class="n">iLast_rep_sync_id</span><span class="o">=-</span><span class="mi">1</span> <span class="k">then</span>
</span><span class='line'>      <span class="k">insert</span> <span class="k">into</span> <span class="n">rep_de_proc_log</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span><span class="n">eid</span><span class="p">,</span><span class="n">tbl</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;rep_shadow_rs&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">set</span> <span class="n">iLast_rep_sync_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">-- 下一个数字   </span>
</span><span class='line'>    <span class="k">set</span> <span class="n">iLast_rep_sync_id</span><span class="o">=</span><span class="n">iLast_rep_sync_id</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">-- 设置默认的返回值为0：失败   </span>
</span><span class='line'>    <span class="k">set</span> <span class="n">rtn</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">-- 启动事务   </span>
</span><span class='line'>    <span class="k">start</span> <span class="n">transaction</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">-- 查找最大编号   </span>
</span><span class='line'>    <span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">rep_sync_id</span><span class="p">)</span> <span class="k">into</span> <span class="n">iMax_rep_sync_id</span> <span class="k">from</span> <span class="n">rep_shadow_rs</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">-- 有新数据   </span>
</span><span class='line'>    <span class="n">if</span> <span class="n">iMax_rep_sync_id</span><span class="o">&gt;=</span><span class="n">iLast_rep_sync_id</span> <span class="k">then</span>
</span><span class='line'>        <span class="c1">-- 调用   </span>
</span><span class='line'>        <span class="k">call</span> <span class="n">pro_rep_shadow_rs_do</span><span class="p">(</span><span class="n">iLast_rep_sync_id</span><span class="p">,</span><span class="n">iMax_rep_sync_id</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">-- 更新日志   </span>
</span><span class='line'>        <span class="k">update</span> <span class="n">rep_de_proc_log</span> <span class="k">set</span> <span class="n">rid</span><span class="o">=</span><span class="n">iLast_rep_sync_id</span><span class="p">,</span><span class="n">eid</span><span class="o">=</span><span class="n">iMax_rep_sync_id</span> <span class="k">where</span> <span class="n">tbl</span><span class="o">=</span><span class="s1">&#39;rep_shadow_rs&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">-- 运行没有异常，提交事务   </span>
</span><span class='line'>    <span class="k">commit</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">-- 设置返回值为1 </span>
</span><span class='line'>    <span class="k">set</span> <span class="n">rtn</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span><span class="p">;</span>
</span><span class='line'><span class="o">|</span>
</span><span class='line'><span class="k">delimiter</span> <span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<!-- more-->


<blockquote></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
<span class='line-number'>362</span>
<span class='line-number'>363</span>
<span class='line-number'>364</span>
<span class='line-number'>365</span>
<span class='line-number'>366</span>
<span class='line-number'>367</span>
<span class='line-number'>368</span>
<span class='line-number'>369</span>
<span class='line-number'>370</span>
<span class='line-number'>371</span>
<span class='line-number'>372</span>
<span class='line-number'>373</span>
<span class='line-number'>374</span>
<span class='line-number'>375</span>
<span class='line-number'>376</span>
<span class='line-number'>377</span>
<span class='line-number'>378</span>
<span class='line-number'>379</span>
<span class='line-number'>380</span>
<span class='line-number'>381</span>
<span class='line-number'>382</span>
<span class='line-number'>383</span>
<span class='line-number'>384</span>
<span class='line-number'>385</span>
<span class='line-number'>386</span>
<span class='line-number'>387</span>
<span class='line-number'>388</span>
<span class='line-number'>389</span>
<span class='line-number'>390</span>
<span class='line-number'>391</span>
<span class='line-number'>392</span>
<span class='line-number'>393</span>
<span class='line-number'>394</span>
<span class='line-number'>395</span>
<span class='line-number'>396</span>
<span class='line-number'>397</span>
<span class='line-number'>398</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">drop</span> <span class="k">procedure</span> <span class="n">if</span> <span class="k">exists</span> <span class="n">pro_rep_shadow_rs_do</span><span class="p">;</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">|</span>
</span><span class='line'><span class="c1">---------------------------------   </span>
</span><span class='line'><span class="c1">-- 处理指定编号范围内的数据   </span>
</span><span class='line'><span class="c1">-- 需要输入2个参数   </span>
</span><span class='line'><span class="c1">-- last_rep_sync_id 是编号的最小值   </span>
</span><span class='line'><span class="c1">-- max_rep_sync_id 是编号的最大值   </span>
</span><span class='line'><span class="c1">-- 无返回值   </span>
</span><span class='line'><span class="c1">---------------------------------   </span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">pro_rep_shadow_rs_do</span><span class="p">(</span><span class="n">last_rep_sync_id</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_rep_sync_id</span> <span class="nb">int</span><span class="p">)</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'>    <span class="k">declare</span> <span class="n">iRep_operationtype</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="k">declare</span> <span class="n">iRep_status</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="k">declare</span> <span class="n">iRep_Sync_id</span> <span class="nb">int</span><span class="p">;</span>
</span><span class='line'>    <span class="k">declare</span> <span class="n">iId</span> <span class="nb">int</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">-- 这个用于处理游标到达最后一行的情况   </span>
</span><span class='line'>    <span class="k">declare</span> <span class="n">stop</span> <span class="nb">int</span> <span class="k">default</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">-- 声明游标   </span>
</span><span class='line'>    <span class="k">declare</span> <span class="n">cur</span> <span class="k">cursor</span> <span class="k">for</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="n">Rep_operationtype</span><span class="p">,</span><span class="n">iRep_status</span><span class="p">,</span><span class="n">rep_sync_id</span> <span class="k">from</span> <span class="n">rep_shadow_rs</span> <span class="k">where</span> <span class="n">rep_sync_id</span> <span class="k">between</span> <span class="n">last_rep_sync_id</span> <span class="k">and</span> <span class="n">max_rep_sync_id</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">-- 声明游标的异常处理，设置一个终止标记   </span>
</span><span class='line'>    <span class="k">declare</span> <span class="k">CONTINUE</span> <span class="k">HANDLER</span> <span class="k">FOR</span> <span class="k">SQLSTATE</span> <span class="s1">&#39;02000&#39;</span> <span class="k">SET</span> <span class="n">stop</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">-- 打开游标   </span>
</span><span class='line'>    <span class="k">open</span> <span class="n">cur</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">-- 读取一行数据到变量   </span>
</span><span class='line'>    <span class="k">fetch</span> <span class="n">cur</span> <span class="k">into</span> <span class="n">iId</span><span class="p">,</span><span class="n">iRep_operationtype</span><span class="p">,</span><span class="n">iRep_status</span><span class="p">,</span><span class="n">iRep_Sync_id</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">-- 这个就是判断是否游标已经到达了最后   </span>
</span><span class='line'>    <span class="n">while</span> <span class="n">stop</span> <span class="o">&lt;&gt;</span> <span class="mi">1</span> <span class="k">do</span>
</span><span class='line'>        <span class="c1">-- 各种判断   </span>
</span><span class='line'>        <span class="n">if</span> <span class="n">iRep_operationtype</span><span class="o">=</span><span class="s1">&#39;I&#39;</span> <span class="k">then</span>
</span><span class='line'>            <span class="k">insert</span> <span class="k">into</span> <span class="n">rs0811</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">fnbm</span><span class="p">)</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="n">fnbm</span> <span class="k">from</span> <span class="n">rep_shadow_rs</span> <span class="k">where</span> <span class="n">rep_sync_id</span><span class="o">=</span><span class="n">iRep_sync_id</span><span class="p">;</span>
</span><span class='line'>        <span class="n">elseif</span> <span class="n">iRep_operationtype</span><span class="o">=</span><span class="s1">&#39;U&#39;</span> <span class="k">then</span>
</span><span class='line'>        <span class="k">begin</span>
</span><span class='line'>            <span class="n">if</span> <span class="n">iRep_status</span><span class="o">=</span><span class="s1">&#39;A&#39;</span> <span class="k">then</span>
</span><span class='line'>                <span class="k">insert</span> <span class="k">into</span> <span class="n">rs0811</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">fnbm</span><span class="p">)</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="n">fnbm</span> <span class="k">from</span> <span class="n">rep_shadow_rs</span> <span class="k">where</span> <span class="n">rep_sync_id</span><span class="o">=</span><span class="n">iRep_sync_id</span><span class="p">;</span>
</span><span class='line'>            <span class="n">elseif</span> <span class="n">iRep_status</span><span class="o">=</span><span class="s1">&#39;B&#39;</span> <span class="k">then</span>
</span><span class='line'>                <span class="k">delete</span> <span class="k">from</span> <span class="n">rs0811</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="n">iId</span><span class="p">;</span>
</span><span class='line'>            <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'>        <span class="k">end</span><span class="p">;</span>
</span><span class='line'>        <span class="n">elseif</span> <span class="n">iRep_operationtype</span><span class="o">=</span><span class="s1">&#39;D&#39;</span> <span class="k">then</span>
</span><span class='line'>            <span class="k">delete</span> <span class="k">from</span> <span class="n">rs0811</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="n">iId</span><span class="p">;</span>
</span><span class='line'>        <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">-- 读取下一行的数据    </span>
</span><span class='line'>        <span class="k">fetch</span> <span class="n">cur</span> <span class="k">into</span> <span class="n">iId</span><span class="p">,</span><span class="n">iRep_operationtype</span><span class="p">,</span><span class="n">iRep_status</span><span class="p">,</span><span class="n">iRep_Sync_id</span><span class="p">;</span>
</span><span class='line'>    <span class="k">end</span> <span class="n">while</span><span class="p">;</span> <span class="c1">-- 循环结束   </span>
</span><span class='line'>    <span class="k">close</span> <span class="n">cur</span><span class="p">;</span> <span class="c1">-- 关闭游标   </span>
</span><span class='line'><span class="k">end</span><span class="p">;</span>
</span><span class='line'><span class="n">use</span> <span class="n">testprocedure</span><span class="p">;</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">simpleproce1</span> <span class="p">(</span><span class="k">out</span> <span class="n">par1</span> <span class="nb">int</span><span class="p">)</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">into</span> <span class="n">par1</span> <span class="k">from</span> <span class="n">proce</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">delimiter</span> <span class="p">;</span>
</span><span class='line'><span class="k">call</span> <span class="n">simpleproce1</span><span class="p">(</span><span class="o">@</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'><span class="k">select</span> <span class="o">@</span><span class="n">a</span><span class="p">;</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">,</span><span class="err">每次只有单一的行可以被取回</span><span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="n">name</span> <span class="k">into</span> <span class="n">par1</span><span class="p">,</span><span class="n">par2</span> <span class="k">from</span> <span class="n">proce</span> <span class="k">LIMIT</span> <span class="mi">1</span><span class="p">;</span><span class="err">中的</span><span class="k">LIMIT</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="n">use</span> <span class="n">testprocedure</span><span class="p">;</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">simpleproce2</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">simpleproce2</span> <span class="p">(</span><span class="k">out</span> <span class="n">par1</span> <span class="nb">int</span><span class="p">,</span><span class="k">out</span> <span class="n">par2</span> <span class="nb">char</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'><span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="n">name</span> <span class="k">into</span> <span class="n">par1</span><span class="p">,</span><span class="n">par2</span> <span class="k">from</span> <span class="n">proce</span> <span class="k">LIMIT</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">delimiter</span> <span class="p">;</span>
</span><span class='line'><span class="k">call</span> <span class="n">simpleproce2</span><span class="p">(</span><span class="o">@</span><span class="n">a</span><span class="p">,</span><span class="o">@</span><span class="n">b</span><span class="p">);</span>
</span><span class='line'><span class="k">select</span> <span class="o">@</span><span class="n">a</span><span class="p">,</span><span class="o">@</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="o">##</span> <span class="o">*********</span><span class="k">second</span> <span class="n">test</span><span class="p">,</span><span class="k">function</span><span class="o">************</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">3</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">FUNCTION</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">hello</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">function</span> <span class="n">hello</span><span class="p">(</span><span class="n">s</span> <span class="nb">char</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span> <span class="k">returns</span> <span class="nb">char</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span class='line'><span class="k">return</span> <span class="n">concat</span><span class="p">(</span><span class="s1">&#39;Hello, &#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="s1">&#39;!&#39;</span><span class="p">);</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">delimiter</span> <span class="p">;</span>
</span><span class='line'><span class="k">select</span> <span class="n">hello</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">show</span> <span class="k">create</span> <span class="k">function</span> <span class="n">testprocedure</span><span class="p">.</span><span class="n">helloG</span>
</span><span class='line'><span class="o">#</span><span class="err">它返回子程序的特征，如数据库，名字，类型，创建者及创建和修改日期</span>
</span><span class='line'><span class="k">show</span> <span class="k">function</span> <span class="n">status</span> <span class="k">like</span> <span class="s1">&#39;hello&#39;</span><span class="k">G</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">4</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">#</span><span class="err">注意</span><span class="n">name</span><span class="err">不能和字段名相同</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">test</span> <span class="o">//</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">test</span> <span class="p">()</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'>    <span class="k">DECLARE</span> <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;bob&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">DECLARE</span> <span class="n">newname</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>    <span class="k">DECLARE</span> <span class="n">xid</span> <span class="nb">INT</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span><span class="n">id</span> <span class="k">INTO</span> <span class="n">newname</span><span class="p">,</span><span class="n">xid</span>
</span><span class='line'>      <span class="k">FROM</span> <span class="n">proce</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
</span><span class='line'>    <span class="k">SELECT</span> <span class="n">newname</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span><span class="p">;</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">test1</span><span class="p">()</span> <span class="o">//</span>
</span><span class='line'><span class="o">#***</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">test2</span> <span class="o">//</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">test2</span> <span class="p">()</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">DECLARE</span> <span class="n">newname</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>    <span class="k">DECLARE</span> <span class="n">xid</span> <span class="nb">INT</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span><span class="n">id</span> <span class="k">INTO</span> <span class="n">newname</span><span class="p">,</span><span class="n">xid</span>
</span><span class='line'>      <span class="k">FROM</span> <span class="n">proce</span> <span class="k">limit</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="k">SELECT</span> <span class="n">newname</span><span class="p">,</span><span class="n">xid</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span><span class="p">;</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">test2</span><span class="p">()</span> <span class="o">//</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">5</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">use</span> <span class="n">testprocedure</span><span class="p">;</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">p1</span> <span class="p">()</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">proce</span><span class="p">;</span>
</span><span class='line'><span class="k">call</span> <span class="n">p1</span><span class="p">();</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">6</span><span class="o">&gt;</span><span class="err">注意此处的</span><span class="k">handler</span><span class="err">是设置</span><span class="k">SQLSTATE</span><span class="err">值，</span><span class="n">SQLWARNING</span><span class="err">是对所有以</span><span class="mi">01</span><span class="err">开头的</span><span class="k">SQLSTATE</span><span class="err">代码的速记</span>
</span><span class='line'><span class="o">#</span><span class="k">NOT</span> <span class="k">FOUND</span><span class="err">是对所有以</span><span class="mi">02</span><span class="err">开头的</span><span class="k">SQLSTATE</span><span class="err">代码的速记</span>
</span><span class='line'><span class="o">#</span><span class="k">SQLEXCEPTION</span><span class="err">是对所有没有被</span><span class="n">SQLWARNING</span><span class="err">或</span><span class="k">NOT</span> <span class="k">FOUND</span><span class="err">捕获的</span><span class="k">SQLSTATE</span><span class="err">代码的速记</span>
</span><span class='line'><span class="o">#</span><span class="k">DECLARE</span> <span class="k">CONTINUE</span> <span class="k">HANDLER</span><span class="err">声明</span><span class="k">CONTINUE</span><span class="err">异常处理</span>
</span><span class='line'><span class="o">#</span><span class="err">事实上这里的</span><span class="mi">23000</span><span class="k">SQLSTATE</span><span class="err">是更常用的，当外键约束出错或主键约束出错就被调用了。</span>
</span><span class='line'><span class="o">#</span><span class="err">当没有发生该</span><span class="mi">23000</span><span class="err">异常时，</span> <span class="k">select</span> <span class="o">@</span><span class="n">x2</span><span class="err">的值将是</span><span class="k">null</span><span class="p">,</span><span class="err">而不是</span><span class="mi">1</span><span class="p">,</span>
</span><span class='line'><span class="o">#</span><span class="err">并且后面的第</span><span class="mi">2</span><span class="err">个语句执行时将会报主键约束错误，此时</span><span class="o">@</span><span class="n">x2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">@</span><span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="err">虽然第</span><span class="mi">2</span><span class="err">句有了异常，但是后面的语句继续执行</span>
</span><span class='line'><span class="o">#</span><span class="err">保存到数据的数据是</span><span class="mi">3</span><span class="p">,</span><span class="n">test3</span><span class="err">和</span><span class="mi">5</span><span class="p">,</span><span class="n">test5</span>
</span><span class='line'><span class="n">use</span> <span class="n">testprocedure</span><span class="p">;</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">handlerdemo</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">handlerdemo</span><span class="p">()</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'><span class="k">declare</span> <span class="k">continue</span> <span class="k">handler</span> <span class="k">for</span> <span class="k">sqlstate</span> <span class="s1">&#39;23000&#39;</span> <span class="k">set</span> <span class="o">@</span><span class="n">x2</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">set</span> <span class="o">@</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">insert</span> <span class="k">into</span> <span class="n">proce</span> <span class="k">values</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;test3&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">set</span> <span class="o">@</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="k">insert</span> <span class="k">into</span> <span class="n">proce</span> <span class="k">values</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;test4&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">set</span> <span class="o">@</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="k">insert</span> <span class="k">into</span> <span class="n">proce</span> <span class="k">values</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;test5&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">set</span> <span class="o">@</span><span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span><span class="p">;</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">handlerdemo</span><span class="p">()</span><span class="o">//</span>
</span><span class='line'><span class="k">select</span> <span class="o">@</span><span class="n">x</span> <span class="o">//</span>
</span><span class='line'><span class="k">select</span> <span class="o">@</span><span class="n">x2</span> <span class="o">//</span>
</span><span class='line'><span class="o">##</span> <span class="o">************</span><span class="err">光标</span><span class="o">****************</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">7</span><span class="o">&gt;</span><span class="err">光标必须在声明处理程序之前被声明，并且变量和条件必须在声明光标或处理程序之前被声明</span>
</span><span class='line'><span class="o">#</span><span class="err">在这里先声明变量</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="k">c</span><span class="p">,</span><span class="err">后声明</span><span class="k">cursor</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">curdemo</span><span class="p">()</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'><span class="k">declare</span> <span class="n">done</span> <span class="nb">int</span> <span class="k">default</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="k">declare</span> <span class="n">a</span> <span class="nb">char</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
</span><span class='line'><span class="k">declare</span> <span class="n">b</span><span class="p">,</span><span class="k">c</span> <span class="nb">int</span><span class="p">;</span>
</span><span class='line'><span class="k">declare</span> <span class="n">cur1</span> <span class="k">cursor</span> <span class="k">for</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="n">name</span> <span class="k">from</span> <span class="n">proce</span><span class="p">;</span>
</span><span class='line'><span class="k">declare</span> <span class="n">cur2</span> <span class="k">cursor</span> <span class="k">for</span> <span class="k">select</span> <span class="n">id</span> <span class="k">from</span> <span class="n">proce2</span><span class="p">;</span>
</span><span class='line'><span class="k">declare</span> <span class="k">continue</span> <span class="k">handler</span> <span class="k">for</span> <span class="k">sqlstate</span> <span class="s1">&#39;02000&#39;</span> <span class="k">set</span> <span class="n">done</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">open</span> <span class="n">cur1</span><span class="p">;</span>
</span><span class='line'><span class="k">open</span> <span class="n">cur2</span><span class="p">;</span>
</span><span class='line'><span class="n">repeat</span>
</span><span class='line'><span class="k">fetch</span> <span class="n">cur1</span> <span class="k">into</span> <span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">;</span>
</span><span class='line'><span class="k">fetch</span> <span class="n">cur2</span> <span class="k">into</span> <span class="k">c</span><span class="p">;</span>
</span><span class='line'><span class="n">if</span> <span class="k">not</span> <span class="n">done</span> <span class="k">then</span>
</span><span class='line'>   <span class="n">if</span> <span class="n">b</span><span class="o">&lt;</span><span class="k">c</span> <span class="k">then</span>
</span><span class='line'>     <span class="k">insert</span> <span class="k">into</span> <span class="n">proce3</span> <span class="k">values</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>   <span class="k">else</span>
</span><span class='line'>     <span class="k">insert</span> <span class="k">into</span> <span class="n">proce3</span> <span class="k">values</span><span class="p">(</span><span class="k">c</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>   <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'><span class="k">until</span> <span class="n">done</span> <span class="k">end</span> <span class="n">repeat</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">close</span> <span class="n">cur1</span><span class="p">;</span>
</span><span class='line'><span class="k">close</span> <span class="n">cur2</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="o">##</span> <span class="o">****************</span> <span class="k">Case</span> <span class="o">*******************</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">8</span><span class="o">&gt;</span><span class="k">when</span> <span class="p">...</span> <span class="k">then</span> <span class="p">;</span><span class="k">case</span> <span class="p">...</span> <span class="k">end</span> <span class="k">case</span><span class="p">;</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">p13</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">p13</span><span class="p">(</span><span class="k">in</span> <span class="n">par1</span> <span class="nb">int</span><span class="p">)</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'><span class="k">declare</span> <span class="n">var1</span> <span class="nb">int</span><span class="p">;</span>
</span><span class='line'><span class="k">set</span> <span class="n">var1</span><span class="o">=</span><span class="n">par1</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="n">var1</span>
</span><span class='line'><span class="k">when</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">casetest</span> <span class="k">values</span><span class="p">(</span><span class="mi">17</span><span class="p">);</span>
</span><span class='line'><span class="k">when</span> <span class="mi">1</span> <span class="k">then</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">casetest</span> <span class="k">values</span><span class="p">(</span><span class="mi">18</span><span class="p">);</span>
</span><span class='line'><span class="k">else</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">casetest</span> <span class="k">values</span><span class="p">(</span><span class="mi">19</span><span class="p">);</span>
</span><span class='line'><span class="k">end</span> <span class="k">case</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span><span class="p">;</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p13</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p13</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p13</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p13</span><span class="p">(</span><span class="k">null</span><span class="p">)</span><span class="o">//</span>
</span><span class='line'>
</span><span class='line'><span class="o">##</span> <span class="o">****************</span> <span class="n">while</span> <span class="o">****************</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">9</span><span class="o">&gt;</span><span class="n">while</span> <span class="p">...</span> <span class="k">do</span> <span class="p">...</span> <span class="k">end</span> <span class="n">while</span><span class="p">;</span><span class="err">为了防止</span><span class="k">null</span><span class="err">的错误，</span><span class="k">set</span> <span class="n">v</span><span class="o">=</span><span class="mi">0</span><span class="err">是必须的</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">p14</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">p14</span><span class="p">()</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'><span class="k">declare</span> <span class="n">v</span> <span class="nb">int</span><span class="p">;</span>
</span><span class='line'><span class="k">set</span> <span class="n">v</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">while</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="k">do</span>
</span><span class='line'>      <span class="k">insert</span> <span class="k">into</span> <span class="n">casetest</span> <span class="k">values</span> <span class="p">(</span><span class="n">v</span><span class="p">);</span>
</span><span class='line'>      <span class="k">set</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span> <span class="n">while</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span><span class="p">;</span><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p14</span><span class="p">()</span><span class="o">//</span>
</span><span class='line'><span class="o">##</span> <span class="o">*****************</span> <span class="n">repeat</span> <span class="o">*****************</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">10</span><span class="o">&gt;</span><span class="n">repeat</span> <span class="p">...</span><span class="k">until</span> <span class="p">...</span> <span class="k">end</span> <span class="n">repeat</span><span class="p">;</span> <span class="err">是执行后检查（</span><span class="k">until</span> <span class="n">v</span><span class="o">&gt;=</span><span class="mi">5</span><span class="err">），而</span><span class="n">while</span><span class="err">是执行前检查</span><span class="p">(</span><span class="n">while</span> <span class="n">v</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">p15</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">p15</span><span class="p">()</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'><span class="k">declare</span> <span class="n">v</span> <span class="nb">int</span><span class="p">;</span>
</span><span class='line'><span class="k">set</span> <span class="n">v</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">repeat</span>
</span><span class='line'>    <span class="k">insert</span> <span class="k">into</span> <span class="n">casetest</span> <span class="k">values</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
</span><span class='line'>    <span class="k">set</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">until</span> <span class="n">v</span> <span class="o">&gt;=</span><span class="mi">5</span>
</span><span class='line'><span class="k">end</span> <span class="n">repeat</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span><span class="p">;</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p15</span><span class="p">()</span><span class="o">//</span>
</span><span class='line'><span class="o">##</span> <span class="o">*****************</span> <span class="n">loops</span> <span class="o">*****************</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">11</span><span class="o">&gt;</span> <span class="n">loop</span> <span class="err">和</span><span class="n">while</span><span class="err">一样不需要初始条件，同时和</span><span class="n">repeat</span><span class="err">一样不需要结束条件</span>
</span><span class='line'><span class="o">#</span>      <span class="n">loop_label</span><span class="p">:</span> <span class="n">loop</span>
</span><span class='line'><span class="o">#</span>      <span class="p">...</span>
</span><span class='line'><span class="o">#</span>       <span class="n">if</span> <span class="p">..</span> <span class="k">then</span>
</span><span class='line'><span class="o">#</span>       <span class="n">leave</span> <span class="n">loop_label</span>
</span><span class='line'><span class="o">#</span>       <span class="k">end</span> <span class="n">if</span>
</span><span class='line'><span class="o">#</span>      <span class="k">end</span> <span class="n">loop</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">p16</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">p16</span><span class="p">()</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'><span class="k">declare</span> <span class="n">v</span> <span class="nb">int</span><span class="p">;</span>
</span><span class='line'><span class="k">set</span> <span class="n">v</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">loop_label</span><span class="p">:</span> <span class="n">loop</span>
</span><span class='line'>    <span class="k">insert</span> <span class="k">into</span> <span class="n">casetest</span> <span class="k">values</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
</span><span class='line'>    <span class="k">set</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="n">if</span> <span class="n">v</span> <span class="o">&gt;=</span><span class="mi">5</span> <span class="k">then</span>
</span><span class='line'>      <span class="n">leave</span> <span class="n">loop_label</span><span class="p">;</span>
</span><span class='line'>    <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span> <span class="n">loop</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span><span class="p">;</span><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p16</span><span class="p">()</span><span class="o">//</span>
</span><span class='line'><span class="o">##</span> <span class="o">*****************</span> <span class="n">Labels</span> <span class="o">*****************</span>
</span><span class='line'><span class="o">#</span> <span class="o">&lt;</span><span class="mi">12</span><span class="o">&gt;</span><span class="n">labels</span><span class="err">标号；</span> <span class="err">注意此处的</span><span class="k">until</span> <span class="mi">0</span><span class="o">=</span><span class="mi">0</span><span class="err">后面没有分号“</span><span class="p">;</span><span class="err">”</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">p17</span><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">p17</span><span class="p">()</span>
</span><span class='line'><span class="n">label_1</span><span class="p">:</span><span class="k">begin</span>
</span><span class='line'><span class="n">label_2</span><span class="p">:</span><span class="n">while</span> <span class="mi">0</span><span class="o">=</span><span class="mi">1</span> <span class="k">do</span> <span class="n">leave</span> <span class="n">label_2</span><span class="p">;</span> <span class="k">end</span> <span class="n">while</span><span class="p">;</span>
</span><span class='line'><span class="n">label_3</span><span class="p">:</span><span class="n">repeat</span> <span class="n">leave</span> <span class="n">label_3</span><span class="p">;</span><span class="k">until</span> <span class="mi">0</span><span class="o">=</span><span class="mi">0</span> <span class="k">end</span> <span class="n">repeat</span><span class="p">;</span>
</span><span class='line'><span class="n">label_4</span><span class="p">:</span><span class="n">loop</span> <span class="n">leave</span> <span class="n">label_4</span><span class="p">;</span> <span class="k">end</span> <span class="n">loop</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span><span class="p">;</span><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p17</span><span class="p">()</span><span class="o">//</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">13</span><span class="o">&gt;</span><span class="n">labels</span> <span class="err">标号结束符；</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">p18</span><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">p18</span><span class="p">()</span>
</span><span class='line'><span class="n">label_1</span><span class="p">:</span><span class="k">begin</span>
</span><span class='line'><span class="n">label_2</span><span class="p">:</span><span class="n">while</span> <span class="mi">0</span><span class="o">=</span><span class="mi">1</span> <span class="k">do</span> <span class="n">leave</span> <span class="n">label_2</span><span class="p">;</span> <span class="k">end</span> <span class="n">while</span> <span class="n">label_2</span><span class="p">;</span>
</span><span class='line'><span class="n">label_3</span><span class="p">:</span><span class="n">repeat</span> <span class="n">leave</span> <span class="n">label_3</span><span class="p">;</span><span class="k">until</span> <span class="mi">0</span><span class="o">=</span><span class="mi">0</span> <span class="k">end</span> <span class="n">repeat</span> <span class="n">label_3</span><span class="p">;</span>
</span><span class='line'><span class="n">label_4</span><span class="p">:</span><span class="n">loop</span> <span class="n">leave</span> <span class="n">label_4</span><span class="p">;</span> <span class="k">end</span> <span class="n">loop</span> <span class="n">label_4</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span> <span class="n">label_1</span><span class="p">;</span><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p18</span><span class="p">()</span><span class="o">//</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">14</span><span class="o">&gt;</span><span class="n">leave</span><span class="err">和</span><span class="n">labels</span> <span class="err">跳出和标号</span><span class="p">;</span><span class="n">leave</span> <span class="err">使程序跳出复杂的语句</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">p19</span><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">p19</span><span class="p">(</span><span class="n">par</span> <span class="nb">char</span><span class="p">)</span>
</span><span class='line'><span class="n">label_1</span><span class="p">:</span><span class="k">begin</span>
</span><span class='line'><span class="n">label_2</span><span class="p">:</span><span class="k">begin</span>
</span><span class='line'><span class="n">label_3</span><span class="p">:</span><span class="k">begin</span>
</span><span class='line'><span class="n">if</span> <span class="n">par</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span> <span class="k">then</span>
</span><span class='line'><span class="n">if</span> <span class="n">par</span><span class="o">=</span><span class="s1">&#39;a&#39;</span> <span class="k">then</span> <span class="n">leave</span> <span class="n">label_1</span><span class="p">;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>   <span class="k">begin</span>
</span><span class='line'>     <span class="n">if</span> <span class="n">par</span><span class="o">=</span><span class="s1">&#39;b&#39;</span> <span class="k">then</span>
</span><span class='line'>       <span class="n">leave</span> <span class="n">label_2</span><span class="p">;</span>
</span><span class='line'>     <span class="k">else</span>
</span><span class='line'>       <span class="n">leave</span> <span class="n">label_3</span><span class="p">;</span>
</span><span class='line'>     <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'>   <span class="k">end</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span> <span class="n">label_3</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span> <span class="n">label_2</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span> <span class="n">label_1</span><span class="p">;</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p19</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">//</span>
</span><span class='line'>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">15</span><span class="o">&gt;</span><span class="k">iterate</span><span class="err">迭代，必须用</span><span class="n">leave</span><span class="p">;</span><span class="k">iterate</span><span class="err">意思是重新开始复合语句，相当于</span> <span class="k">continue</span>
</span><span class='line'><span class="o">#</span><span class="err">该结果中</span><span class="mi">3</span><span class="err">将不被保存到数据库表中</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">p20</span><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">p20</span><span class="p">()</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'><span class="k">declare</span> <span class="n">v</span> <span class="nb">int</span><span class="p">;</span>
</span><span class='line'><span class="k">set</span> <span class="n">v</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">loop_label</span><span class="p">:</span><span class="n">loop</span>
</span><span class='line'>    <span class="n">if</span> <span class="n">v</span><span class="o">=</span><span class="mi">3</span> <span class="k">then</span>
</span><span class='line'>      <span class="k">set</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="k">iterate</span> <span class="n">loop_label</span><span class="p">;</span>
</span><span class='line'>    <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'>    <span class="k">insert</span> <span class="k">into</span> <span class="n">casetest</span> <span class="k">values</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
</span><span class='line'>    <span class="k">set</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="n">if</span> <span class="n">v</span><span class="o">&gt;=</span><span class="mi">5</span> <span class="k">then</span>
</span><span class='line'>      <span class="n">leave</span> <span class="n">loop_label</span><span class="p">;</span>
</span><span class='line'>    <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span> <span class="n">loop</span> <span class="n">loop_label</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span><span class="p">;</span><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p20</span><span class="p">()</span><span class="o">//</span>
</span><span class='line'>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">16</span><span class="o">&gt;</span><span class="n">Grand</span> <span class="n">combination</span><span class="err">大组合</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">procedure</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">p21</span><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">p21</span><span class="p">(</span><span class="k">in</span> <span class="n">par1</span> <span class="nb">int</span><span class="p">,</span><span class="k">out</span> <span class="n">par2</span> <span class="nb">int</span><span class="p">)</span>
</span><span class='line'><span class="k">language</span> <span class="k">sql</span> <span class="k">deterministic</span> <span class="k">sql</span> <span class="k">security</span> <span class="k">invoker</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'><span class="k">declare</span> <span class="n">v</span> <span class="nb">int</span><span class="p">;</span>
</span><span class='line'><span class="n">label</span> <span class="n">goto_label</span><span class="p">;</span>
</span><span class='line'><span class="n">start_label</span><span class="p">:</span><span class="n">loop</span>
</span><span class='line'>    <span class="n">if</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span> <span class="k">then</span>
</span><span class='line'>      <span class="n">leave</span> <span class="n">start_label</span><span class="p">;</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="k">iterate</span> <span class="n">start_label</span><span class="p">;</span>
</span><span class='line'>    <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span> <span class="n">loop</span> <span class="n">start_label</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">repeat</span>
</span><span class='line'>    <span class="n">while</span> <span class="mi">1</span><span class="o">=</span><span class="mi">0</span> <span class="k">do</span> <span class="k">begin</span> <span class="k">end</span><span class="p">;</span>
</span><span class='line'>    <span class="k">end</span> <span class="n">while</span><span class="p">;</span>
</span><span class='line'><span class="k">until</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span>
</span><span class='line'><span class="k">end</span> <span class="n">repeat</span><span class="p">;</span>
</span><span class='line'><span class="k">goto</span> <span class="n">goto_label</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span><span class="p">;</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="k">call</span> <span class="n">p21</span><span class="p">()</span><span class="o">//</span>
</span><span class='line'><span class="o">##</span> <span class="o">****************</span> <span class="k">trigger</span> <span class="o">***************************</span>
</span><span class='line'><span class="o">#&lt;</span><span class="mi">17</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">use</span> <span class="n">testprocedure</span><span class="p">;</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">trig1</span><span class="p">(</span><span class="n">a1</span> <span class="nb">int</span><span class="p">);</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">trig2</span><span class="p">(</span><span class="n">a2</span> <span class="nb">int</span><span class="p">);</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">trig3</span><span class="p">(</span><span class="n">a3</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">);</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">trig4</span><span class="p">(</span>
</span><span class='line'><span class="n">a4</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
</span><span class='line'><span class="n">b4</span> <span class="nb">INT</span> <span class="k">DEFAULT</span> <span class="mi">0</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'><span class="k">insert</span> <span class="k">into</span> <span class="n">trig3</span><span class="p">(</span><span class="n">a3</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="k">null</span><span class="p">),(</span><span class="k">null</span><span class="p">),(</span><span class="k">null</span><span class="p">),(</span><span class="k">null</span><span class="p">),(</span><span class="k">null</span><span class="p">),(</span><span class="k">null</span><span class="p">),(</span><span class="k">null</span><span class="p">),(</span><span class="k">null</span><span class="p">),(</span><span class="k">null</span><span class="p">),(</span><span class="k">null</span><span class="p">);</span>
</span><span class='line'><span class="k">insert</span> <span class="k">into</span> <span class="n">trig4</span><span class="p">(</span><span class="n">a4</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="k">delimiter</span> <span class="o">//</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">trigger</span> <span class="n">trigtest</span><span class="o">//</span>
</span><span class='line'><span class="k">create</span> <span class="k">trigger</span> <span class="n">trigtest</span> <span class="k">before</span> <span class="k">insert</span> <span class="k">on</span> <span class="n">trig1</span>
</span><span class='line'><span class="k">for</span> <span class="k">each</span> <span class="k">row</span> <span class="k">begin</span>
</span><span class='line'><span class="k">insert</span> <span class="k">into</span> <span class="n">trig2</span> <span class="k">set</span> <span class="n">a2</span><span class="o">=</span><span class="k">NEW</span><span class="p">.</span><span class="n">a1</span><span class="p">;</span>
</span><span class='line'><span class="k">delete</span> <span class="k">from</span> <span class="n">trig3</span> <span class="k">where</span> <span class="n">a3</span><span class="o">=</span><span class="k">NEW</span><span class="p">.</span><span class="n">a1</span><span class="p">;</span>
</span><span class='line'><span class="k">update</span> <span class="n">trig4</span> <span class="k">set</span> <span class="n">b4</span><span class="o">=</span><span class="n">b4</span><span class="o">+</span><span class="mi">1</span> <span class="k">where</span> <span class="n">a4</span><span class="o">=</span><span class="k">NEW</span><span class="p">.</span><span class="n">a1</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span><span class="p">;</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'>
</span><span class='line'><span class="k">delimiter</span> <span class="p">;</span>
</span><span class='line'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">trig1</span> <span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span><span class='line'><span class="c1">------ -------------------------------------------------------------------------</span>
</span><span class='line'><span class="k">Drop</span> <span class="k">Procedure</span> <span class="n">If</span> <span class="k">Exists</span> <span class="n">p_report</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">Delimiter</span> <span class="n">forend</span>
</span><span class='line'>
</span><span class='line'><span class="k">Create</span> <span class="k">Procedure</span> <span class="n">p_report</span>
</span><span class='line'><span class="p">(</span><span class="k">In</span> <span class="k">year</span> <span class="nb">Int</span><span class="p">,</span>
</span><span class='line'><span class="k">In</span> <span class="k">month</span> <span class="nb">Int</span><span class="p">,</span>
</span><span class='line'><span class="k">In</span> <span class="n">Id</span> <span class="nb">Char</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
</span><span class='line'><span class="k">Out</span> <span class="n">status</span> <span class="nb">Int</span><span class="p">)</span>
</span><span class='line'><span class="k">Begin</span>
</span><span class='line'><span class="n">SelectYear</span><span class="p">,</span>
</span><span class='line'><span class="k">Month</span><span class="p">,</span>
</span><span class='line'><span class="n">OfficeId</span><span class="p">,</span>
</span><span class='line'><span class="n">OnTimeRate</span>
</span><span class='line'><span class="n">FromReportByMonth</span>
</span><span class='line'><span class="n">WhereOfficeId</span> <span class="o">=</span> <span class="n">Id</span> <span class="k">And</span>
</span><span class='line'><span class="k">Year</span> <span class="o">=</span> <span class="k">year</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">End</span>
</span><span class='line'>
</span><span class='line'><span class="n">forend</span>
</span><span class='line'>
</span><span class='line'><span class="k">Delimiter</span> <span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>MySQL 存储过程参数有三种类型：in、out、inout。它们各有什么作用和特点呢？</h3>

<h4>一、MySQL 存储过程参数（in）</h4>

<p>MySQL 存储过程 “in” 参数：跟 C 语言的函数参数的值传递类似， MySQL 存储过程内部可能会修改此参数，但对 in 类型参数的修改，对调用者（caller）来说是不可见的（not visible）。
drop procedure if exists pr_param_in;create procedure pr_param_in( in id int &#8211; in 类型的 MySQL 存储过程参数)begin if (id is not null) then set id = id + 1; end if; select id as id_inner;end;set @id = 10;call pr_param_in(@id);select @id as id_out;mysql> call pr_param_in(@id);+&#8212;&#8212;&#8212;-+| id_inner |+&#8212;&#8212;&#8212;-+| 11 |+&#8212;&#8212;&#8212;-+mysql> select @id as id_out;+&#8212;&#8212;&#8211;+| id_out |+&#8212;&#8212;&#8211;+| 10 |+&#8212;&#8212;&#8211;+
可以看到：用户变量 @id 传入值为 10，执行存储过程后，在过程内部值为：11（id_inner），但外部变量值依旧为：10（id_out）。</p>

<h4>二、MySQL 存储过程参数（out）</h4>

<p>MySQL 存储过程 “out” 参数：从存储过程内部传值给调用者。在存储过程内部，该参数初始值为 null，无论调用者是否给存储过程参数设置值。
drop procedure if exists pr_param_out;create procedure pr_param_out( out id int)begin select id as id_inner_1; &#8211; id 初始值为 null if (id is not null) then set id = id + 1; select id as id_inner_2; else select 1 into id; end if; select id as id_inner_3;end;set @id = 10;call pr_param_out(@id);select @id as id_out;mysql> set @id = 10;mysql>mysql> call pr_param_out(@id);+&#8212;&#8212;&#8212;&#8212;+| id_inner_1 |+&#8212;&#8212;&#8212;&#8212;+| NULL |+&#8212;&#8212;&#8212;&#8212;++&#8212;&#8212;&#8212;&#8212;+| id_inner_3 |+&#8212;&#8212;&#8212;&#8212;+| 1 |+&#8212;&#8212;&#8212;&#8212;+mysql> select @id as id_out;+&#8212;&#8212;&#8211;+| id_out |+&#8212;&#8212;&#8211;+| 1 |+&#8212;&#8212;&#8211;+
可以看出，虽然我们设置了用户定义变量 @id 为 10，传递 @id 给存储过程后，在存储过程内部，id 的初始值总是 null（id_inner_1）。最后 id 值（id_out = 1）传回给调用者。</p>

<h4>三、MySQL 存储过程参数（inout）</h4>

<p>MySQL 存储过程 inout 参数跟 out 类似，都可以从存储过程内部传值给调用者。不同的是：调用者还可以通过 inout 参数传递值给存储过程。
drop procedure if exists pr_param_inout;create procedure pr_param_inout( inout id int)begin select id as id_inner_1; &#8211; id 值为调用者传进来的值 if (id is not null) then set id = id + 1; select id as id_inner_2; else select 1 into id; end if; select id as id_inner_3;end;set @id = 10;call pr_param_inout(@id);select @id as id_out;mysql> set @id = 10;mysql>mysql> call pr_param_inout(@id);+&#8212;&#8212;&#8212;&#8212;+| id_inner_1 |+&#8212;&#8212;&#8212;&#8212;+| 10 |+&#8212;&#8212;&#8212;&#8212;++&#8212;&#8212;&#8212;&#8212;+| id_inner_2 |+&#8212;&#8212;&#8212;&#8212;+| 11 |+&#8212;&#8212;&#8212;&#8212;++&#8212;&#8212;&#8212;&#8212;+| id_inner_3 |+&#8212;&#8212;&#8212;&#8212;+| 11 |+&#8212;&#8212;&#8212;&#8212;+mysql>mysql> select @id as id_out;+&#8212;&#8212;&#8211;+| id_out |+&#8212;&#8212;&#8211;+| 11 |+&#8212;&#8212;&#8211;+
从结果可以看出：我们把 @id（10），传给存储过程后，存储过程最后又把计算结果值 11（id_inner_3）传回给调用者。 MySQL 存储过程 inout 参数的行为跟 C 语言函数中的引用传值类似。
通过以上例子：如果仅仅想把数据传给 MySQL 存储过程，那就使用“in” 类型参数；如果仅仅从 MySQL 存储过程返回值，那就使用“out” 类型参数；如果需要把数据传给 MySQL 存储过程，还要经过一些计算后再传回给我们，此时，要使用“inout” 类型参数。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MySQL Note]]></title>
    <link href="http://woody1983.github.com/blog/2010/05/23/mysql-note/"/>
    <updated>2010-05-23T23:43:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2010/05/23/mysql-note</id>
    <content type="html"><![CDATA[<h2>Select查询细节：</h2>

<h3>【匹配多个字符】</h3>

<p><code>SELECT __ FROM __ WHERE ___ LIKE 'Smith% Corp.'</code></p>

<h4>Smith Corp. Smithson Corp &#8230;&#8230;&#8230;&#8230;  %通配符可以匹配0个或多个字符</h4>

<h3>【匹配单个字符】</h3>

<p><code>SELECT __ FROM __ WHERE ___ LIKE 'Smiths_n Corp.'</code></p>

<h4>Smithson Smithsen</h4>

<h3>【以上模式的组合使用】</h3>

<h4>&#8216;Smiths_n %&#8217;</h4>

<h3>【转义字符】</h3>

<p>比如搜索“A%BC”开始的产品   <code>'A$%BC%' ESCAPE '$'</code></p>

<h3>【判断null】</h3>

<p>不能使用=来判断 IS NULL  IS NOT NULL</p>

<h3>【NOT判断】</h3>

<p><code>AND NOT SALES &lt; 1500 不小于1500的</code></p>

<h3>【索引使用情况】</h3>

<ul>
<li><code>Handler_read_key</code> 如果索引正在工作 这个值会很高</li>
<li><code>Handler_read_rnd_next</code> 值如果高 证明查询运行低效</li>
</ul>


<!-- more -->


<h3>【索引缓存优化】</h3>

<ul>
<li><code>Key_read_requests</code> 从缓存中读取索引的次数</li>
<li><code>Key_reads</code> 从硬盘中读取索引的请求次数</li>
<li>[my.cnf] <code>key_buffer_size = 256M</code> 只缓存索引键
或者直接修改 <code>SET GLOBAL key_buffer_size = 256M</code></li>
</ul>


<h3>【表缓存优化】</h3>

<ul>
<li><code>Open_tables</code>  当前打开表的缓存数 flush tables会关闭一些当前没有使用的表缓存</li>
<li><code>Opened_file</code>s 曾经打开过的表缓存数 flush tables 不会改变大小</li>
<li><code>[my.cnf]  table_open_cache = 128</code> #这个值与系统的<code>max_connections</code>有关</li>
<li><code>SET GLOBAL table_open_cache = 12</code>8</li>
</ul>


<h3>【innodb的优化设置】</h3>

<ul>
<li><code>innodb_buffer_pool_size</code> #同时为数据块和索引块做缓存 和oracle一样 值越高 IO访问就越少 建议物理内存的80%</li>
<li><code>innodb_buffer_pool_size = 64M</code></li>
<li>innodb_flush_log_at_trx_commit</li>
</ul>


<blockquote><p>控制缓冲区中的数据写入到日志文件以及日志文件刷新磁盘的时机。
* 0的时候 每秒一次的被写入到日志文件,并且对日志文件做向磁盘刷新的操作 但是一个事务提交不做任何操作。崩溃的时候数据库会丢失没有写到日志文件中的事务。最多丢失一秒钟的事务。最不安全 效率最高。
* 1的时候 每个事务提交的时候 日志缓冲被写到日志文件 并且对日志文件做向磁盘刷新的操作。默认。每个事务提交的时候都会从log buffer写到日志文件 实际刷新磁盘 有性能上一定消耗。
* 2的时候 每个事务提交时 日志缓冲被写到日志文件 但不对日志文件做向磁盘刷新的操作。没有刷新磁盘，但已经写入到日志文件，只要操作系统没有崩溃，那么并没有丢失数据，比0安全。
* <code>innodb_additional_mem_pool_size</code>  状态值怎么查？ status
* Innodb引擎用来储存引擎数据库结构和其他内部数据结构的内存池的大小，默认1M。应用程序里的表越多就应该分配越多的内存，如果innodb用光了这个内存就会向系统内存要。并且写入警告日志。不要太大内存 16,足以。
<code>innodb_lock_wait_timeout</code></p>

<p>自动监测行锁导致的死锁并进行相应的处理，但是不能对表锁导致的死锁进行自动监测。参数主要是被用于在出现类似情况的时候等待指定的时间后回滚，默认是50秒。
<code>innodb_support_xa</code>
是否支持分布式事务 默认是1或ON 如果应用中不使用分布式事务就关闭该参数 减少磁盘刷新的次数并获得innodb性能。
<code>innodb_log_buffer_size</code>
日志缓存的大小 默认的设置在中等强度写入负载以及较短事务的情况下，一般可以满足服务器的性能要求。如果更新操作峰值或者负载较大就应该加大这个值。8-16M即可。
<code>innodb_log_file_size</code>
日志组log group中每个日志文件的大小 在高写入负载尤其是大数据集的情况下很重要。这个值越大性能就越高，副作用是恢复时时间会加长。<code>默认是5M</code>。
Javaeye推荐<code>innodb_log_file_size = 64M</code></p>

<h4>需要注意的是 修改完以后要STOP服务 接着删除原来的日志ib_logfile0和ib_logfile1，然后启动服务，看新日志的大小是否为设置的值。</h4>

<h2>整体性能分析报告</h2></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; show engine innodb status \G
</span><span class='line'>innodb_file_per_table</span></code></pre></td></tr></table></div></figure>


<blockquote><p>取值为ON或者OFF。是否为每个table使用单独的数据文件保存。如果系统中表的个数不多，并且没有超大表，使用该参数可以使得各个表之间的 维护相对独立，有一定的好处。innodb_flush_method究竟应不应该使用O_DIRECT？</p>

<h4>innodb_flush_method究竟应不应该使用O_DIRECT？</h4></blockquote>

<p>所有MySQL调优的建议都说，如果硬件没有预读功能，那么使用O_DIRECT将极大降低InnoDB的性能，因为O_DIRECT跳过了操作 系统的文件系统Disk Cache，让MySQL直接读写磁盘了。</p>

<p>但是在我的实践中来看，如果不使用O_DIRECT，操作系统被迫开辟大量的Disk Cache用于innodb的读写缓存，不但没有提高读写性能，反而造成读写性能急剧下降。而且buffer pool的数据缓存和操作系统Disk Cache缓存造成了Double buffer的浪费，显然从我这个实践来看，浪费得非常厉害。</p>

<p>说O_DIRECT造成MySQL直接读写磁盘造成得性能下降问题，我觉得完全是杞人忧天。因为从JavaEye的数据库监测来看，Innodb 的buffer pool命中率非常高，有98%以上，真正的磁盘操作是微乎其微的。为了1%的磁盘操作能够得到Disk Cache，而浪费了98%的double buffer内存空间，无论从性能上看，还是从内存资源的消耗来看，都是非常不明智的。</p>

<h3>【查询缓存 MySQL Query Cache】</h3>

<ul>
<li>存储SELECT查村的文本以及相应结果作为缓存。</li>
<li><code>have_query_cache</code>  是否配置高速缓存</li>
<li><code>query_cache_size</code> 缓存大小</li>
<li><code>query_cache_type</code> #0和OFF 缓存关闭； 1或者ON 缓存打开 使用SQL_NO_CACHE的SELECT除外；2或者demand 只有带SQL_CACHE的SELECT语句提供高速缓存。</li>
<li><code>query_cache_limit</code> 单个查询能够使用的缓存区大小  如果超过就不使用cache了</li>
<li><code>query_cache_min_res_unit</code> 单个存储块的内存分配大小 Qcache_queries_in_cache和Qcache_total_blocks的比例如果是1:2是正合适的，如果再大就需要调整了。</li>
<li><code>Qcache_free_blocks</code> 查询缓存中的空闲内存块的数目</li>
<li><code>Qcache_free_memory</code> 查询缓存中的空闲内存总数</li>
<li><code>Qcache_hits</code> 缓存采样数数目</li>
<li><code>Qcache_inserts</code> 被加入到缓存中的查询数目。</li>
<li><code>Qcache_lowmem_prunes</code> 因为缺少内存而被从缓存中删除的查询数目。</li>
<li><code>Qcache_not_cached</code> 没有被缓存的查询数目，由query_cache_type带来的。</li>
<li><code>Qcache_queries_in_cache</code> 在缓存中已注册的查询数目。</li>
<li><code>Qcache_total_blocks</code> 查询缓存中的块的总数目。</li>
</ul>


<h3>【mysqld读取my.cnf的顺序】</h3>

<ul>
<li>第一搜，首先读取<code>/etc/my.cnf</code>，多实例这个配置 文件不会存在。</li>
<li>第二搜，<code>$datadir/my.cnf</code>，在data目录下寻找此配置文件。</li>
<li>第三搜，<code>defaultfile=/path/my.cnf</code> 通常写在命令行上，mysqld_safe defaultfile=/tmp/my.cnf &amp;等执行。</li>
<li>第四搜，<code>~/my.cnf</code> 当前用户下的配置文件。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MySQL存储过程 写着玩的]]></title>
    <link href="http://woody1983.github.com/blog/2010/05/23/mysql-sp-funny/"/>
    <updated>2010-05-23T19:23:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2010/05/23/mysql-sp-funny</id>
    <content type="html"><![CDATA[<h3>uid and mid</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">DELIMITER</span> <span class="err">$$</span>
</span><span class='line'>
</span><span class='line'><span class="k">DROP</span> <span class="k">PROCEDURE</span>  <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">file_test</span><span class="p">;</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">file_test</span><span class="p">(</span><span class="k">IN</span> <span class="n">p_uid</span> <span class="nb">INT</span><span class="p">,</span> <span class="k">IN</span> <span class="n">p_mid</span> <span class="nb">INT</span><span class="p">,</span> <span class="k">OUT</span> <span class="n">p_count</span> <span class="nb">INT</span><span class="p">)</span>
</span><span class='line'><span class="k">READS</span> <span class="k">SQL</span> <span class="k">DATA</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span><span class="n">uname</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">emp</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">uid</span> <span class="o">=</span> <span class="n">p_uid</span>
</span><span class='line'><span class="k">AND</span> <span class="n">mid</span> <span class="o">=</span> <span class="n">p_mid</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">SELECT</span> <span class="n">FOUND_ROWS</span><span class="p">()</span> <span class="k">INTO</span> <span class="n">p_count</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span> <span class="err">$$</span>
</span><span class='line'>
</span><span class='line'><span class="k">DELIMITER</span> <span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<!-- more-->


<h3>查询 uid 大于等于多少 并且 mid小于多少</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">DELIMITER</span> <span class="err">$$</span>
</span><span class='line'>
</span><span class='line'><span class="k">DROP</span> <span class="k">PROCEDURE</span>  <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">pro_or</span><span class="p">;</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">pro_or</span><span class="p">(</span><span class="k">IN</span> <span class="n">p_uid</span> <span class="nb">INT</span><span class="p">,</span> <span class="k">IN</span> <span class="n">p_mid</span> <span class="nb">INT</span><span class="p">,</span> <span class="k">OUT</span> <span class="n">p_count</span> <span class="nb">INT</span><span class="p">)</span>
</span><span class='line'><span class="k">READS</span> <span class="k">SQL</span> <span class="k">DATA</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'><span class="k">SET</span> <span class="o">@</span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span><span class="n">uname</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">emp</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">uid</span> <span class="o">&gt;=</span> <span class="n">p_uid</span>
</span><span class='line'><span class="k">AND</span> <span class="n">mid</span> <span class="o">&lt;</span> <span class="n">p_mid</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">SELECT</span> <span class="n">FOUND_ROWS</span><span class="p">()</span> <span class="k">INTO</span> <span class="n">p_count</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span> <span class="err">$$</span>
</span><span class='line'>
</span><span class='line'><span class="k">DELIMITER</span> <span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">CALL</span> <span class="n">pro_or</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="o">@</span><span class="n">asd</span><span class="p">);</span>
</span><span class='line'><span class="o">+</span><span class="c1">----+-------+</span>
</span><span class='line'><span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">uname</span> <span class="o">|</span>
</span><span class='line'><span class="o">+</span><span class="c1">----+-------+</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="n">aaa</span>   <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="n">bbb</span>   <span class="o">|</span>
</span><span class='line'><span class="o">+</span><span class="c1">----+-------+</span>
</span><span class='line'><span class="mi">2</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">@</span><span class="n">asd</span><span class="p">;</span>
</span><span class='line'><span class="o">+</span><span class="c1">------+</span>
</span><span class='line'><span class="o">|</span> <span class="o">@</span><span class="n">asd</span> <span class="o">|</span>
</span><span class='line'><span class="o">+</span><span class="c1">------+</span>
</span><span class='line'><span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>
</span><span class='line'><span class="o">+</span><span class="c1">------+</span>
</span><span class='line'><span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">@</span><span class="n">x</span><span class="p">;</span>
</span><span class='line'><span class="o">+</span><span class="c1">------+</span>
</span><span class='line'><span class="o">|</span> <span class="o">@</span><span class="n">x</span>   <span class="o">|</span>
</span><span class='line'><span class="o">+</span><span class="c1">------+</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">10</span> <span class="o">|</span>
</span><span class='line'><span class="o">+</span><span class="c1">------+</span>
</span><span class='line'><span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>ceil(100*rand())</p>

<h3>@插入N条数据</h3></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">DELIMITER</span> <span class="err">$$</span>
</span><span class='line'><span class="k">DROP</span> <span class="k">PROCEDURE</span>  <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">auto_insert</span><span class="p">;</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">auto_insert</span><span class="p">(</span><span class="k">IN</span> <span class="n">a_string</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'><span class="k">set</span> <span class="o">@</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">ins</span><span class="p">:</span> <span class="n">LOOP</span>
</span><span class='line'><span class="k">set</span> <span class="o">@</span><span class="n">x</span> <span class="o">=</span> <span class="o">@</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="n">IF</span> <span class="o">@</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1000</span> <span class="k">then</span>
</span><span class='line'><span class="n">leave</span> <span class="n">ins</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span> <span class="n">IF</span><span class="p">;</span>
</span><span class='line'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">emp</span><span class="p">(</span><span class="n">uname</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">mid</span><span class="p">)</span> <span class="k">VALUES</span><span class="p">(</span><span class="n">a_string</span><span class="p">,</span><span class="n">ceil</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">rand</span><span class="p">()),</span><span class="n">ceil</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">rand</span><span class="p">()));</span>
</span><span class='line'><span class="k">END</span> <span class="n">LOOP</span> <span class="n">ins</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span><span class="p">;</span>
</span><span class='line'><span class="err">$$</span>
</span><span class='line'><span class="k">DELIMITER</span> <span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>简单的</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">usp1</span><span class="p">(</span><span class="k">IN</span> <span class="n">P</span> <span class="nb">INT</span><span class="p">)</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'><span class="k">SET</span> <span class="o">@</span><span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span>
</span><span class='line'>
</span><span class='line'><span class="k">CALL</span> <span class="n">usp1</span><span class="p">(</span><span class="mi">12345</span><span class="p">);</span>
</span><span class='line'><span class="k">select</span> <span class="o">@</span><span class="n">x</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>输出函数</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">create</span> <span class="k">procedure</span> <span class="n">usp2</span><span class="p">(</span><span class="k">OUT</span> <span class="n">p</span> <span class="nb">INT</span><span class="p">,</span> <span class="k">IN</span> <span class="n">p2</span> <span class="nb">INT</span><span class="p">)</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'><span class="k">SET</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">delimiter</span> <span class="err">$$</span>
</span><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">procedure</span> <span class="n">usp2</span><span class="p">(</span><span class="k">OUT</span> <span class="n">p</span> <span class="nb">INT</span><span class="p">,</span> <span class="k">IN</span> <span class="n">p2</span> <span class="nb">INT</span><span class="p">)</span>
</span><span class='line'><span class="o">-&gt;</span> <span class="k">BEGIN</span>
</span><span class='line'><span class="o">-&gt;</span> <span class="k">SET</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="o">-&gt;</span> <span class="k">END</span>
</span><span class='line'><span class="o">-&gt;</span> <span class="err">$$</span>
</span><span class='line'><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">delimiter</span> <span class="p">;</span>
</span><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">CALL</span> <span class="n">usp2</span><span class="p">(</span><span class="o">@</span><span class="n">a</span><span class="p">,</span><span class="mi">123</span><span class="p">);</span>
</span><span class='line'><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">@</span><span class="n">a</span><span class="p">;</span>
</span><span class='line'><span class="o">+</span><span class="c1">------+</span>
</span><span class='line'><span class="o">|</span> <span class="o">@</span><span class="n">a</span>   <span class="o">|</span>
</span><span class='line'><span class="o">+</span><span class="c1">------+</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">246</span> <span class="o">|</span>
</span><span class='line'><span class="o">+</span><span class="c1">------+</span>
</span><span class='line'><span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>INOUT</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">DROP</span> <span class="k">PROCEDURE</span>  <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">demosp</span><span class="p">;</span>
</span><span class='line'><span class="k">delimiter</span> <span class="err">$$</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">demosp</span><span class="p">(</span><span class="k">IN</span> <span class="n">inputParam</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="k">INOUT</span> <span class="n">inOutParam</span> <span class="nb">INT</span><span class="p">)</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'><span class="k">SET</span> <span class="n">inOutParam</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">inOutParam</span><span class="p">;</span>
</span><span class='line'><span class="k">SELECT</span> <span class="n">CONCAT</span><span class="p">(</span><span class="s1">&#39;Hello &#39;</span><span class="p">,</span><span class="n">inputParam</span><span class="p">);</span>
</span><span class='line'><span class="k">END</span>
</span><span class='line'><span class="err">$$</span>
</span><span class='line'><span class="k">delimiter</span> <span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>CALL demosp(&#8216;Woody&#8217;,@q);
select @q;</p>

<h3>互相调用</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">get_time</span><span class="p">()</span>
</span><span class='line'><span class="k">SET</span> <span class="o">@</span><span class="k">current_time</span> <span class="o">=</span> <span class="n">CURTIME</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">part_of_day</span><span class="p">()</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'><span class="k">CALL</span> <span class="n">get_time</span><span class="p">();</span>
</span><span class='line'><span class="n">IF</span> <span class="o">@</span><span class="k">current_time</span> <span class="o">&lt;</span> <span class="s1">&#39;12:00:00&#39;</span> <span class="k">THEN</span>
</span><span class='line'><span class="k">SET</span> <span class="o">@</span><span class="n">day_part</span> <span class="o">=</span> <span class="s1">&#39;morning&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">ELSEIF</span> <span class="o">@</span><span class="k">current_time</span> <span class="o">=</span> <span class="s1">&#39;12:00:00&#39;</span> <span class="k">THEN</span>
</span><span class='line'><span class="k">SET</span> <span class="o">@</span><span class="n">day_part</span> <span class="o">=</span> <span class="s1">&#39;noon&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">ELSE</span>
</span><span class='line'><span class="k">SET</span> <span class="o">@</span><span class="n">day_part</span> <span class="o">=</span> <span class="s1">&#39;afternoon or night&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span> <span class="n">IF</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MySQL 多實例練習實錄]]></title>
    <link href="http://woody1983.github.com/blog/2010/05/23/mysql-multi/"/>
    <updated>2010-05-23T19:12:00+08:00</updated>
    <id>http://woody1983.github.com/blog/2010/05/23/mysql-multi</id>
    <content type="html"><![CDATA[<h4>流程：</h4>

<ul>
<li>初始化一个库 然后-P端口号 -hIP地址进去</li>
<li>配置权限</li>
<li>接着用multi来实现管理。 以start和stop为主。</li>
<li>@MYSQL server没有启动</li>
<li>@建仓</li>
<li>@修改my.cnf</li>
<li>@mysqld_multi start 005</li>
<li>@mysql_install_db &#8211;user=mysql &#8211;datadir=/db5</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@MySQL-NDB ~]# cd /
</span><span class='line'>[root@MySQL-NDB /]# mkdir db7
</span><span class='line'>[root@MySQL-NDB /]# chown -R mysql.mysql db7
</span><span class='line'>[root@MySQL-NDB /]# cd db7
</span><span class='line'>[root@MySQL-NDB db7]# vim /etc/my.cnf 
</span><span class='line'>&lt;!-- more--&gt;
</span><span class='line'>
</span><span class='line'>[mysqld007]
</span><span class='line'>port            = 3312
</span><span class='line'>socket          = /db7/mysql.sock
</span><span class='line'>pid-file        = /db7/mysqld007.pid
</span><span class='line'>datadir         = /db7
</span><span class='line'>server-id       = 7
</span><span class='line'>log-bin         = mysql-bin</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@MySQL-NDB db7]# mysql_install_db --user=mysql --datadir=/db7
</span><span class='line'>[root@MySQL-NDB db7]# ls -la
</span><span class='line'>total 20
</span><span class='line'>drwxr-xr-x  4 mysql mysql 4096 May 13 05:14 .
</span><span class='line'>drwxr-xr-x 27 root  root  4096 May 13 05:12 ..
</span><span class='line'>drwx------  2 mysql root  4096 May 13 05:14 mysql
</span><span class='line'>drwx------  2 mysql root  4096 May 13 05:14 test
</span><span class='line'>[root@MySQL-NDB db7]# mysqld_multi start 007
</span><span class='line'>[root@MySQL-NDB db7]# ls -la
</span><span class='line'>total 11408
</span><span class='line'>drwxr-xr-x  4 mysql mysql     4096 May 13 05:15 .
</span><span class='line'>drwxr-xr-x 27 root  root      4096 May 13 05:12 ..
</span><span class='line'>-rw-rw----  1 mysql mysql 10485760 May 13 05:15 ibdata1
</span><span class='line'>-rw-rw----  1 mysql mysql  1150976 May 13 05:15 ib_logfile0
</span><span class='line'>drwx------  2 mysql root      4096 May 13 05:14 mysql
</span><span class='line'>-rw-rw----  1 mysql mysql        0 May 13 05:15 mysql-bin.index
</span><span class='line'>-rw-rw----  1 mysql root       543 May 13 05:15 MySQL-NDB.err
</span><span class='line'>drwx------  2 mysql root      4096 May 13 05:14 test
</span><span class='line'>
</span><span class='line'>[root@MySQL-NDB db7]# netstat -tunlp
</span><span class='line'>Active Internet connections (only servers)
</span><span class='line'>Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   
</span><span class='line'>tcp        0      0 0.0.0.0:3307                0.0.0.0:*                   LISTEN      2011/mysqld         
</span><span class='line'>tcp        0      0 0.0.0.0:3308                0.0.0.0:*                   LISTEN      2113/mysqld         
</span><span class='line'>tcp        0      0 0.0.0.0:3309                0.0.0.0:*                   LISTEN      2213/mysqld         
</span><span class='line'>tcp        0      0 0.0.0.0:3310                0.0.0.0:*                   LISTEN      2606/mysqld         
</span><span class='line'>tcp        0      0 0.0.0.0:3311                0.0.0.0:*                   LISTEN      2858/mysqld         
</span><span class='line'>tcp        0      0 0.0.0.0:3312                0.0.0.0:*                   LISTEN      3023/mysqld         
</span><span class='line'>tcp        0      0 :::22                       :::*                        LISTEN      1649/sshd   </span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@MySQL-NDB db7]# mysql -P3312 -h127.0.0.1
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 1
</span><span class='line'>Server version: 5.1.46-log MySQL Community Server (GPL)
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2010, Oracle and/or its affiliates. All rights reserved.
</span><span class='line'>This software comes with ABSOLUTELY NO WARRANTY. This is free software,
</span><span class='line'>and you are welcome to modify and redistribute it under the GPL v2 license
</span><span class='line'>
</span><span class='line'>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
</span><span class='line'>
</span><span class='line'>mysql&gt; \s
</span><span class='line'>--------------
</span><span class='line'>mysql  Ver 14.14 Distrib 5.1.46, for pc-linux-gnu (i686) using readline 5.1
</span><span class='line'>
</span><span class='line'>Connection id:          1
</span><span class='line'>Current database:
</span><span class='line'>Current user:           root@localhost
</span><span class='line'>SSL:                    Not in use
</span><span class='line'>Current pager:          stdout
</span><span class='line'>Using outfile:          ''
</span><span class='line'>Using delimiter:        ;
</span><span class='line'>Server version:         5.1.46-log MySQL Community Server (GPL)
</span><span class='line'>Protocol version:       10
</span><span class='line'>Connection:             127.0.0.1 via TCP/IP
</span><span class='line'>Server characterset:    latin1
</span><span class='line'>Db     characterset:    latin1
</span><span class='line'>Client characterset:    latin1
</span><span class='line'>Conn.  characterset:    latin1
</span><span class='line'>TCP port:               3312
</span><span class='line'>Uptime:                 39 sec
</span><span class='line'>
</span><span class='line'>Threads: 1  Questions: 4  Slow queries: 0  Opens: 15  Flush tables: 1  Open tables: 8  Queries per second avg: 0.102
</span><span class='line'>--------------</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@MySQL-NDB db7]# ls -la
</span><span class='line'>total 20556
</span><span class='line'>drwxr-xr-x  4 mysql mysql     4096 May 13 05:15 .
</span><span class='line'>drwxr-xr-x 27 root  root      4096 May 13 05:12 ..
</span><span class='line'>-rw-rw----  1 mysql mysql 10485760 May 13 05:15 ibdata1
</span><span class='line'>-rw-rw----  1 mysql mysql  5242880 May 13 05:15 ib_logfile0
</span><span class='line'>-rw-rw----  1 mysql mysql  5242880 May 13 05:15 ib_logfile1
</span><span class='line'>drwx------  2 mysql root      4096 May 13 05:14 mysql
</span><span class='line'>-rw-rw----  1 mysql mysql      106 May 13 05:15 mysql-bin.000001
</span><span class='line'>-rw-rw----  1 mysql mysql       19 May 13 05:15 mysql-bin.index
</span><span class='line'>-rw-rw----  1 mysql mysql        5 May 13 05:15 mysqld006.pid
</span><span class='line'>-rw-rw----  1 mysql root      1196 May 13 05:15 MySQL-NDB.err
</span><span class='line'>srwxrwxrwx  1 mysql mysql        0 May 13 05:15 mysql.sock
</span><span class='line'>drwx------  2 mysql root      4096 May 13 05:14 test</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@MySQL-NDB db]# mysql_install_db --user=mysql
</span><span class='line'>[root@MySQL-NDB db]# service mysql start
</span><span class='line'>
</span><span class='line'>否则
</span><span class='line'>[root@MySQL-NDB db]# service mysql start
</span><span class='line'>Starting MySQL... ERROR! Manager of pid-file quit without updating file.
</span><span class='line'>pid-file=/db/mysqld001.pid
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>GRANT SHUTDOWN ON *.*  TO 'multi_admin'@'localhost' IDENTIFIED BY 'multipass';</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[mysqld_multi]
</span><span class='line'>mysqld     = /usr/bin/mysqld_safe
</span><span class='line'>mysqladmin = /usr/bin/mysqladmin
</span><span class='line'>user       = multi_admin
</span><span class='line'>password   = multipass
</span><span class='line'>
</span><span class='line'>[mysqld002]
</span><span class='line'>port            = 3307
</span><span class='line'>socket          = /db/mysql.sock
</span><span class='line'>pid-file        = /db/mysqld001.pid
</span><span class='line'>datadir         = /db
</span><span class='line'>skip-locking
</span><span class='line'>key_buffer_size = 16M
</span><span class='line'>max_allowed_packet = 1M
</span><span class='line'>table_open_cache = 64
</span><span class='line'>sort_buffer_size = 512K
</span><span class='line'>net_buffer_length = 8K
</span><span class='line'>read_buffer_size = 256K
</span><span class='line'>read_rnd_buffer_size = 512K
</span><span class='line'>myisam_sort_buffer_size = 8M
</span><span class='line'>log-bin=mysql-bin
</span><span class='line'>binlog_format=mixed
</span><span class='line'>server-id       = 1
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[mysqld003]
</span><span class='line'>port            = 3308
</span><span class='line'>socket          = /db2/mysql.sock
</span><span class='line'>pid-file        = /db2/mysqld002.pid
</span><span class='line'>datadir         = /db2
</span><span class='line'>server-id       = 2
</span><span class='line'>log-bin         = mysql-bin
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>###############
</span><span class='line'>| Innodb_buffer_pool_read_requests  | 77      |
</span><span class='line'>| Innodb_buffer_pool_reads               | 12      |
</span><span class='line'>(Innodb_buffer_pool_read_requests - Innodb_buffer_pool_reads) / Innodb_buffer_pool_read_requests * 100%
</span><span class='line'>
</span><span class='line'>77-12/77
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>###################
</span><span class='line'>
</span><span class='line'>[mysqld008]
</span><span class='line'>port            = 3318
</span><span class='line'>socket          = /db8/mysql.sock
</span><span class='line'>pid-file        = /db8/mysqld008.pid
</span><span class='line'>datadir         = /db8
</span><span class='line'>server-id       = 8
</span><span class='line'>log-bin         = mysql-bin
</span><span class='line'>skip_slave_start = 1
</span><span class='line'>
</span><span class='line'>innodb_buffer_pool_size = 64M
</span><span class='line'>innodb_flush_log_at_trx_commit = 2
</span><span class='line'>innodb_additional_mem_pool_size = 16M
</span><span class='line'>innodb_lock_wait_timeout = 30
</span><span class='line'>innodb_support_xa = OFF
</span><span class='line'>innodb_log_buffer_size = 32M
</span><span class='line'>innodb_flush_method = O_DIRECT
</span><span class='line'>innodb_log_file_size = 15M
</span><span class='line'>
</span><span class='line'>[mysqld009]
</span><span class='line'>port            = 3319
</span><span class='line'>socket          = /db9/mysql.sock
</span><span class='line'>pid-file        = /db9/mysqld009.pid
</span><span class='line'>datadir         = /db9
</span><span class='line'>server-id       = 9
</span><span class='line'>log-bin         = mysql-bin
</span><span class='line'>skip_slave_start = 1
</span><span class='line'>
</span><span class='line'>replicate_ignore_table = mysql.columns_priv
</span><span class='line'>replicate_ignore_table = mysql.db
</span><span class='line'>replicate_ignore_table = mysql.host
</span><span class='line'>replicate_ignore_table = mysql.procs_priv
</span><span class='line'>replicate_ignore_table = mysql.tables_priv
</span><span class='line'>replicate_ignore_table = mysql.user
</span><span class='line'>
</span><span class='line'>innodb_buffer_pool_size = 64M
</span><span class='line'>innodb_flush_log_at_trx_commit = 2
</span><span class='line'>innodb_additional_mem_pool_size = 16M
</span><span class='line'>innodb_lock_wait_timeout = 30
</span><span class='line'>innodb_support_xa = OFF
</span><span class='line'>innodb_log_buffer_size = 32M
</span><span class='line'>innodb_flush_method = O_DIRECT
</span><span class='line'>innodb_log_file_size = 15M</span></code></pre></td></tr></table></div></figure>


<p><code>grant replication slave ON *.* TO 'rep009'@'localhost' identified by '12345';</code></p>

<p><code>GRANT SHUTDOWN ON *.*  TO 'multi_admin'@'localhost' IDENTIFIED BY 'multipass';</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql-bin.000001 527
</span><span class='line'>
</span><span class='line'>009
</span><span class='line'>CHANGE MASTER TO
</span><span class='line'>MASTER_HOST = '192.168.200.200',
</span><span class='line'>MASTER_PORT = 3318,
</span><span class='line'>MASTER_USER = 'rep009',
</span><span class='line'>MASTER_PASSWORD = '12345',
</span><span class='line'>MASTER_LOG_FILE = 'mysql-bin.000001',
</span><span class='line'>MASTER_LOG_POS = 743</span></code></pre></td></tr></table></div></figure>


<p>;</p>
]]></content>
  </entry>
  
</feed>
